<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>crazyczy&#39;s blog</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://chaizi.one/"/>
  <updated>2020-03-13T07:07:16.549Z</updated>
  <id>https://chaizi.one/</id>
  
  <author>
    <name>crazyczy</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>在信息过载的时代重新拥抱RSS</title>
    <link href="https://chaizi.one/2019/08/06/%E5%9C%A8%E4%BF%A1%E6%81%AF%E8%BF%87%E8%BD%BD%E7%9A%84%E6%97%B6%E4%BB%A3%E9%87%8D%E6%96%B0%E6%8B%A5%E6%8A%B1RSS/"/>
    <id>https://chaizi.one/2019/08/06/%E5%9C%A8%E4%BF%A1%E6%81%AF%E8%BF%87%E8%BD%BD%E7%9A%84%E6%97%B6%E4%BB%A3%E9%87%8D%E6%96%B0%E6%8B%A5%E6%8A%B1RSS/</id>
    <published>2019-08-05T16:00:00.000Z</published>
    <updated>2020-03-13T07:07:16.549Z</updated>
    
    <content type="html"><![CDATA[<p>我自认为是一个自制力比较差的人，所以我很少用信息流的产品，因为我很清楚自己一但开始刷就会停不下来。但即使这样，微信群的讨论我还是会忍不住参与进去，朋友圈虽然不是“无底洞”，但也总忍不住去看有没有新的朋友圈。<br><span id="more"></span></p><p>日子一天天过去，我发现自己的时间都碎片化了，我看的越来越多的是那种几分钟就能看完的公众号文章和那种十几分钟的短视频，不再能静下心来好好的看一本书，也不再能坐下来好好欣赏一部电影。</p><p>于是我决定重新用回<a href="https://zh.wikipedia.org/wiki/RSS">RSS</a>，这个曾在十多年前风靡一时的格式，如今已被大部分人所抛弃。人们不再关心自己真正想要的是什么，各种各样的APP不停的推给你信息，却不管你是否真正关心这些信息。</p><p>一般大的网站都会有官方提供的RSS订阅，有些没有的也可以在<a href="https://github.com/DIYgod/RSSHub">RSSHub</a>上找到，真的就如他们所说，万物皆可RSS。有了这些RSS链接，我们就需要一个RSS阅读器来管理他们，这里我比较推荐的是<a href="https://www.inoreader.com">Inoreader</a>，Android和iOS平台都有，电脑上可以在浏览器上看，但是体验可能不如移动端。Inoreader有收费的套餐，但是我觉得免费的已经很好用了，150的订阅限制对于我这个轻度用户来说已经绰绰有余。</p><p>除了图文的RSS订阅，播客（Podcast）也是RSS的一种。之前用过喜马拉雅，平台虽然方便但是也会带来一些别的问题，广告什么的都还能忍受，资源不够完整和更新不及时就不是小问题了，所以我现在更推荐泛用型播客，和RSS阅读器一样，你可以通过RSS订阅喜欢的主播而不用担心被平台删减或者下架。iOS平台我比较推荐<a href="https://overcast.fm/">Overcast</a>，如果你是Android用户，我之前用过<a href="https://castbox.fm/">Castbox</a>，但是我现在更喜欢Google出的<a href="https://podcasts.google.com/about">Podcast</a>，简洁好用，配合一个好的降噪耳机，你会发现通勤时间也可以这么有趣。</p><p>顺便说一句，女朋友玩微博，但是RSSHub的微博订阅最近出问题了，所以我换了<a href="https://github.com/zgq354/weibo-rss">weibo-rss</a>订阅了女朋友的微博，这样就不会错过更新啦！</p><p>最后，如果大家对我的博客感兴趣，也可以通过这个<a href="https://rsshub.app/hexo/next/chaizi.one">RSS</a>来订阅我的博客。:)</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;我自认为是一个自制力比较差的人，所以我很少用信息流的产品，因为我很清楚自己一但开始刷就会停不下来。但即使这样，微信群的讨论我还是会忍不住参与进去，朋友圈虽然不是“无底洞”，但也总忍不住去看有没有新的朋友圈。&lt;br&gt;
    
    </summary>
    
    
      <category term="生活技巧" scheme="https://chaizi.one/categories/%E7%94%9F%E6%B4%BB%E6%8A%80%E5%B7%A7/"/>
    
    
      <category term="RSS" scheme="https://chaizi.one/tags/RSS/"/>
    
      <category term="Podcast" scheme="https://chaizi.one/tags/Podcast/"/>
    
  </entry>
  
  <entry>
    <title>网易云音乐歌单下载</title>
    <link href="https://chaizi.one/2019/05/29/%E7%BD%91%E6%98%93%E4%BA%91%E9%9F%B3%E4%B9%90%E6%AD%8C%E5%8D%95%E4%B8%8B%E8%BD%BD/"/>
    <id>https://chaizi.one/2019/05/29/%E7%BD%91%E6%98%93%E4%BA%91%E9%9F%B3%E4%B9%90%E6%AD%8C%E5%8D%95%E4%B8%8B%E8%BD%BD/</id>
    <published>2019-05-28T16:00:00.000Z</published>
    <updated>2020-02-29T13:13:14.605Z</updated>
    
    <content type="html"><![CDATA[<p>随着人们的音乐版权意识变强，现在下载歌曲变得不像以前那么方便了，就算开了会员还是会有下载数量限制，这就很难受。<br><span id="more"></span></p><p>网易云音乐一些会员才能下载的歌曲你用手机网页打开却能找到歌曲的真实<code>URL</code>，然后就可以直接下载，这样就绕过了会员下载的限制，用电脑浏览器调成手机模式也一样可以。我觉得网易云音乐应该知道这个<code>bug</code>，但是可能因为分享出去的歌曲只能通过这种方式来打开，所以没办法。但是这种方式还是不能下载已经下架的和那种试听都要会员的歌曲，这也在情理之中。</p><p>于是我就想能不能写个脚本来批量下载歌曲，找了个现成的接口，免去了自己去分析网易云音乐请求的麻烦，这里感谢一下<a href="https://api.imjad.cn/cloudmusic.md">网易云音乐接口</a>。</p><p>在这个接口的基础上写了一个脚本，可以根据歌单<code>id</code>批量下载网易云音乐歌单中的歌曲，默认下载的是最高的音质，然后自动命名为歌曲名 - 歌手名。这样下载的歌曲还有一个问题就是没有封面图，虽然不影响听，但是看着有点难受，于是我又找了<code>eyed3</code>这个第三方库来给歌曲添加封面图。这里遇到一点问题，就是在调用<code>audiofile.tag.images.set</code>函数写入图片的时候第四个参数也就是描述信息如果传空值或者不传图片就写入不进去，需要注意一下。</p><p>具体的代码可以看<a href="https://gist.github.com/crazyczy/bc4b99854254065c2338f4fa0e8371cf">这里</a>，调用的时候传歌单<code>id</code>就可以了，就像这样<code>python cloudmusic.py 123456</code>。</p><p>虽然这样方便了下载歌曲，但还是希望大家能支持正版音乐，毕竟没有版权费的歌手哪来的动力写好听的歌呢。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;随着人们的音乐版权意识变强，现在下载歌曲变得不像以前那么方便了，就算开了会员还是会有下载数量限制，这就很难受。&lt;br&gt;
    
    </summary>
    
    
      <category term="实战经验" scheme="https://chaizi.one/categories/%E5%AE%9E%E6%88%98%E7%BB%8F%E9%AA%8C/"/>
    
    
      <category term="Python" scheme="https://chaizi.one/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>为了能更方便地看云端视频</title>
    <link href="https://chaizi.one/2018/03/22/%E4%B8%BA%E4%BA%86%E8%83%BD%E6%9B%B4%E6%96%B9%E4%BE%BF%E5%9C%B0%E7%9C%8B%E4%BA%91%E7%AB%AF%E8%A7%86%E9%A2%91/"/>
    <id>https://chaizi.one/2018/03/22/%E4%B8%BA%E4%BA%86%E8%83%BD%E6%9B%B4%E6%96%B9%E4%BE%BF%E5%9C%B0%E7%9C%8B%E4%BA%91%E7%AB%AF%E8%A7%86%E9%A2%91/</id>
    <published>2018-03-21T16:00:00.000Z</published>
    <updated>2020-02-29T13:10:17.943Z</updated>
    
    <content type="html"><![CDATA[<p>为了更方便的看视频，把视频放到云端是一个再好不过的方法。云端有两种，一种是局域网，一种是公网。<br><span id="more"></span></p><h1 id="方案篇"><a href="#方案篇" class="headerlink" title="方案篇"></a>方案篇</h1><p>先说局域网，现在市面上的很多路由器都支持外部存储，这就相当于在局域网里搭建了一个共享文件中转站。虽然有更好的NAS解决方案，但是苦于囊中羞涩，我选择了廉价的极路由来搭建我的局域网文件中转站。之前我用过极1s，但是那个只能用SD卡作为存储，不够方便，于是我又从闲鱼上收了一个极2，这一款相比于极1s多了USB接口，可以把我闲置的U盘利用起来。极路由默认使用的是samba协议进行文件传输，当然也可以装插件来实现FTP的文件共享。</p><p><img src="https://i.imgur.com/B38yyzL.png" alt=""></p><p>公网上我在服务器上搭了一套nextcloud，nextcloud是一套开源的私有云解决方案，支持全平台的设备。换句话说，我放在nextcloud上的视频可以在任何能联网的设备上观看，这就很符合我的心意了哈哈。nextcloud虽然支持全平台，但是实现方案都是同步盘，相当于还是把视频下到本地来看，除了web端并不能直接在线播放，但是web端的在线播放也有弊端，用的h5的原生播放器，功能很是简陋。但是nextcloud提供了WebDAV的访问方式，这个可以结合其他软件使用。</p><p><img src="https://i.imgur.com/PdHN36m.jpg" alt=""></p><p>局域网文件中转站的好处是传输速度快，但是缺点也显而易见，就是只能在局域网内分享文件。公网上的视频文件可以在任何可以联网的地方看，但是传输速度受限与服务器的带宽。总之各有利弊吧。</p><h1 id="软件篇"><a href="#软件篇" class="headerlink" title="软件篇"></a>软件篇</h1><p>说完云端的两种存储方案，再来谈谈各个平台设备上可以观看云端视频的软件吧。</p><p>先说最常用的Windows平台，Windows平台上在资源管理器就可以直接打开samba的文件，播放器方面首推Potplayer，除了支持上面所说的WebDAV的访问方式，还支持HTTP和FTP的远程访问方式，可以说很强大了。</p><p>Mac OS平台上暂时未找到好用的支持远程的播放器，但是Finder里是可以直接打开samba协议的视频的，不过速度有点慢，体验不是很好。</p><p>IOS端强烈推荐nplayer，功能强大，支持包括WebDAV，FTP，SFTP及samba等各种远程协议的视频播放，反正是我用过的最好的播放器了。</p><p>nplayer最近也出了Android端，但是目前只有GP上可以下载，而且售价不菲。<del>在Android上我们可以选择ES+MXPlayer的方案，虽然麻烦一点，但是至少不需要下载下来就可以看啦。</del>(2018.4.2更新，Android上发现了更好用的VLC播放器，支持Samba，FTP，SFTP，NFS等多种远程协议，也支持倍速播放)</p><p><img src="https://i.imgur.com/oePfwwm.png" alt=""></p><p>另外还有一个叫kodi的软件也是支持全平台的，但是软件风格我感觉装在Android盒子上会更合适一点，晚点可以在我的Remix mini上试一试。</p><p>为了能看云端视频真是煞费苦心，但是即使这样传输速度过慢还是很影响体验，以后有钱了还是直接搞一套NAS吧，毕竟千兆万兆普及的时代应该不远了吧。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;为了更方便的看视频，把视频放到云端是一个再好不过的方法。云端有两种，一种是局域网，一种是公网。&lt;br&gt;
    
    </summary>
    
    
      <category term="实战经验" scheme="https://chaizi.one/categories/%E5%AE%9E%E6%88%98%E7%BB%8F%E9%AA%8C/"/>
    
    
      <category term="samba" scheme="https://chaizi.one/tags/samba/"/>
    
      <category term="nextcloud" scheme="https://chaizi.one/tags/nextcloud/"/>
    
  </entry>
  
  <entry>
    <title>Supervisor不完全填坑指北</title>
    <link href="https://chaizi.one/2017/09/23/Supervisor%E4%B8%8D%E5%AE%8C%E5%85%A8%E5%A1%AB%E5%9D%91%E6%8C%87%E5%8C%97/"/>
    <id>https://chaizi.one/2017/09/23/Supervisor%E4%B8%8D%E5%AE%8C%E5%85%A8%E5%A1%AB%E5%9D%91%E6%8C%87%E5%8C%97/</id>
    <published>2017-09-22T16:00:00.000Z</published>
    <updated>2020-02-29T13:10:11.174Z</updated>
    
    <content type="html"><![CDATA[<p>这篇文章不是Supervisor的教程，我只是记录一下我遇到的一些坑。<br><span id="more"></span></p><blockquote><p><a href="http://supervisord.org" title="http://supervisord.org">Supervisor</a>是一个用Python写的进程管理工具，可以很方便的用来启动、重启、关闭进程（不仅仅是Python进程）。除了对单个进程的控制，还可以同时启动、关闭多个进程，比如很不幸的服务器出问题导致所有应用程序都被杀死，此时可以用Supervisor同时启动所有应用程序而不是一个一个地敲命令启动。</p></blockquote><p>记得第一次部署Falsk的时候用过Supervisor，虚拟环境用的是virtualenv，当时也没遇到什么问题，后来用Anaconda来隔离环境以后Supervisor就不好使了，当时比较忙也就没在意，毕竟Supervisor只是一个辅助工具，并不影响网站的使用，只不过是网站挂掉以后要手动重启有点麻烦罢了。正好最近有时间，就想好好找一下Anaconda+Django+uwsgi部署网站时用不了Supervisor的原因。</p><p>按照网上的教程安装Supervisor很顺利，但是就是启动uwsgi服务的时候报错，错误提示</p><pre><code>FATAL      Exited too quickly (process log may have details)</code></pre><p>然后去看错误日志，说找不到对应的Module，猜想是环境变量的问题，于是将虚拟环境的PATH变量加到系统的环境变量里面，但还是报错。于是又经过多次查找，发现supervisord.conf里面可以用</p><pre><code>environment=KEY=value       ; (key value pairs to add to environment)</code></pre><p>来指定环境变量，于是在配置文件里面加上了虚拟环境的PATH变量以后就可以了。</p><p>总结一下，既要在系统的PATH变量里面加上虚拟环境的PATH变量，也要在conf文件中指定environment，缺一不可。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;这篇文章不是Supervisor的教程，我只是记录一下我遇到的一些坑。&lt;br&gt;
    
    </summary>
    
    
      <category term="实战经验" scheme="https://chaizi.one/categories/%E5%AE%9E%E6%88%98%E7%BB%8F%E9%AA%8C/"/>
    
    
      <category term="Python" scheme="https://chaizi.one/tags/Python/"/>
    
      <category term="Supervisor" scheme="https://chaizi.one/tags/Supervisor/"/>
    
  </entry>
  
  <entry>
    <title>每月一块钱轻松实现科学上网</title>
    <link href="https://chaizi.one/2017/07/02/%E6%AF%8F%E6%9C%88%E4%B8%80%E5%9D%97%E9%92%B1%E5%AE%9E%E7%8E%B0%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91/"/>
    <id>https://chaizi.one/2017/07/02/%E6%AF%8F%E6%9C%88%E4%B8%80%E5%9D%97%E9%92%B1%E5%AE%9E%E7%8E%B0%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91/</id>
    <published>2017-07-01T16:00:00.000Z</published>
    <updated>2020-02-29T13:13:18.529Z</updated>
    
    <content type="html"><![CDATA[<p>之前在<a href="/2016/11/09/Nginx+uWSGI+Django部署小记/" title="Nginx+uWSGI+Django部署小记">Nginx+uWSGI+Django部署小记</a>提到过腾讯云的<a href="https://www.qcloud.com/act/campus">云+校园计划</a>，学生认证之后服务器一个月只要一块钱，虽然配置是低了点，不过拿来搭建一个科学上网的梯子足够了。<br><span id="more"></span><br>腾讯云以前只有国内的服务器可以选，也就没想过可以用它来搭梯子，最近无意中发现多了境外的服务器可以选择，不禁蠢蠢欲动。<br><img src="https://i.imgur.com/5XqtgUB.png" alt=""></p><p>我们这里选择香港的服务器，其他那些境外的服务器虽然也可以选择但是价格比较贵，这就违背了我们标题的初衷。</p><p>选择最便宜的那个机型然后安装一个Linux系统，这里系统选择很多，CentOS 6+，Debian 7+，Ubuntu 12+都可以，我用的是Ubuntu Server 14.04.1 LTS 32位，再然后按照步骤一步步走下去最终我们就拥有了一个香港的服务器了！</p><p>接下来我们需要给服务器装上Shadowsocks的服务端，这里参考<a href="https://teddysun.com/486.html" title="Shadowsocks 一键安装脚本（四合一）">Shadowsocks 一键安装脚本（四合一）</a>，自己用命令行一点点安装也是可以的，但是一键安装脚本会方便很多。具体步骤上面那个网址已经写的很清楚了，这里就不赘述了。</p><p>最后我们还需要下载一个Shadowsocks的客户端，将我们设置的参数填进去就可以开心的科学上网了！</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;之前在&lt;a href=&quot;/2016/11/09/Nginx+uWSGI+Django部署小记/&quot; title=&quot;Nginx+uWSGI+Django部署小记&quot;&gt;Nginx+uWSGI+Django部署小记&lt;/a&gt;提到过腾讯云的&lt;a href=&quot;https://www.qcloud.com/act/campus&quot;&gt;云+校园计划&lt;/a&gt;，学生认证之后服务器一个月只要一块钱，虽然配置是低了点，不过拿来搭建一个科学上网的梯子足够了。&lt;br&gt;
    
    </summary>
    
    
      <category term="生活技巧" scheme="https://chaizi.one/categories/%E7%94%9F%E6%B4%BB%E6%8A%80%E5%B7%A7/"/>
    
    
      <category term="Shadowsocks" scheme="https://chaizi.one/tags/Shadowsocks/"/>
    
      <category term="科学上网" scheme="https://chaizi.one/tags/%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91/"/>
    
  </entry>
  
  <entry>
    <title>CI框架的多文件上传</title>
    <link href="https://chaizi.one/2017/04/12/CI%E6%A1%86%E6%9E%B6%E7%9A%84%E5%A4%9A%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"/>
    <id>https://chaizi.one/2017/04/12/CI%E6%A1%86%E6%9E%B6%E7%9A%84%E5%A4%9A%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/</id>
    <published>2017-04-11T16:00:00.000Z</published>
    <updated>2020-02-29T13:07:58.138Z</updated>
    
    <content type="html"><![CDATA[<p>好久没来写博客了。</p><p>最近工作中遇到一个棘手的问题——CI框架的多文件上传，经过各种查资料+实践总算是解决了，觉得有必要记录一下遇到的一些坑。<br><span id="more"></span><br>首先是前端页面，form表单的enctype属性要设置为<code>multipart/form-data</code>，表示不对字符编码。在使用包含文件上传控件的表单时，必须使用该值。input控件<code>&lt;input multiple=&quot;&quot; name=&quot;annex[]&quot; type=&quot;file&quot;&gt;</code>中要有multiple属性，要不然在选文件的时候就只能选一个文件，name属性要设置成一个数组，这里如果name属性写成annex那么不管前端页面选了多少文件，后台的$_FILES也只能获取到第一个文件的值。</p><p>前端其他没啥好说的，选择完文件后用ajax传到后端，代码类似于这样</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$.ajax(&#123;</span><br><span class="line">    type: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">    url: <span class="string">&quot;……&quot;</span>,</span><br><span class="line">    data: <span class="keyword">new</span> FormData($(<span class="string">&#x27;#formid&#x27;</span>)[<span class="number">0</span>]),</span><br><span class="line">    cache: <span class="literal">false</span>,</span><br><span class="line">    processData: <span class="literal">false</span>,</span><br><span class="line">    contentType: <span class="literal">false</span>,</span><br><span class="line">    success: <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>这里processData设置为false表示不去转换提交的信息，contentType因为前面已经设置了enctype所以这里不需要再设置。</p><p>最重要的就是后端怎么来获取到这些文件并把他们上传到服务器了，这里主要思想就是重新构造$_FILES，将$_FILES转换成upload类能够处理的类型，这样才能实现多文件的上传。</p><p>传过来的$_FILES是这个样子的<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">Array</span><br><span class="line">(</span><br><span class="line">    [annex] &#x3D;&gt; Array</span><br><span class="line">        (</span><br><span class="line">            [name] &#x3D;&gt; Array</span><br><span class="line">                (</span><br><span class="line">                    [0] &#x3D;&gt; test1.pdf</span><br><span class="line">                    [1] &#x3D;&gt; test2.pdf</span><br><span class="line">                )</span><br><span class="line"></span><br><span class="line">            [type] &#x3D;&gt; Array</span><br><span class="line">                (</span><br><span class="line">                    [0] &#x3D;&gt; application&#x2F;pdf</span><br><span class="line">                    [1] &#x3D;&gt; application&#x2F;pdf</span><br><span class="line">                )</span><br><span class="line"></span><br><span class="line">            [tmp_name] &#x3D;&gt; Array</span><br><span class="line">                (</span><br><span class="line">                    [0] &#x3D;&gt; &#x2F;tmp&#x2F;phpXV4NMA</span><br><span class="line">                    [1] &#x3D;&gt; &#x2F;tmp&#x2F;phpGIknQm</span><br><span class="line">                )</span><br><span class="line"></span><br><span class="line">            [error] &#x3D;&gt; Array</span><br><span class="line">                (</span><br><span class="line">                    [0] &#x3D;&gt; 0</span><br><span class="line">                    [1] &#x3D;&gt; 0</span><br><span class="line">                )</span><br><span class="line"></span><br><span class="line">            [size] &#x3D;&gt; Array</span><br><span class="line">                (</span><br><span class="line">                    [0] &#x3D;&gt; 140289</span><br><span class="line">                    [1] &#x3D;&gt; 123612</span><br><span class="line">                )</span><br><span class="line"></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">)</span><br></pre></td></tr></table></figure><br>我们要转换成下面这个样子<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Array</span><br><span class="line">(</span><br><span class="line">    [0] &#x3D;&gt; Array</span><br><span class="line">        (</span><br><span class="line">            [name] &#x3D;&gt; test1.pdf</span><br><span class="line">            [type] &#x3D;&gt; application&#x2F;pdf</span><br><span class="line">            [tmp_name] &#x3D;&gt; &#x2F;tmp&#x2F;phpXV4NMA</span><br><span class="line">            [error] &#x3D;&gt; 0</span><br><span class="line">            [size] &#x3D;&gt; 140289</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    [1] &#x3D;&gt; Array</span><br><span class="line">        (</span><br><span class="line">            [name] &#x3D;&gt; test2.pdf</span><br><span class="line">            [type] &#x3D;&gt; application&#x2F;pdf</span><br><span class="line">            [tmp_name] &#x3D;&gt; &#x2F;tmp&#x2F;phpGIknQm</span><br><span class="line">            [error] &#x3D;&gt; 0</span><br><span class="line">            [size] &#x3D;&gt; 123612</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">)</span><br></pre></td></tr></table></figure></p><p>转换代码大概长这样<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$annex</span> = <span class="keyword">array</span>();</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;annex&#x27;</span>][<span class="string">&#x27;error&#x27;</span>] <span class="keyword">as</span> <span class="variable">$k</span> =&gt; <span class="variable">$v</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$annex</span>[] = <span class="keyword">array</span>(</span><br><span class="line">        <span class="string">&#x27;name&#x27;</span>     =&gt; <span class="variable">$_FILES</span>[<span class="string">&#x27;annex&#x27;</span>][<span class="string">&#x27;name&#x27;</span>][<span class="variable">$k</span>],</span><br><span class="line">        <span class="string">&#x27;type&#x27;</span>     =&gt; <span class="variable">$_FILES</span>[<span class="string">&#x27;annex&#x27;</span>][<span class="string">&#x27;type&#x27;</span>][<span class="variable">$k</span>],</span><br><span class="line">        <span class="string">&#x27;tmp_name&#x27;</span> =&gt; <span class="variable">$_FILES</span>[<span class="string">&#x27;annex&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>][<span class="variable">$k</span>],</span><br><span class="line">        <span class="string">&#x27;error&#x27;</span>    =&gt; <span class="variable">$_FILES</span>[<span class="string">&#x27;annex&#x27;</span>][<span class="string">&#x27;error&#x27;</span>][<span class="variable">$k</span>],</span><br><span class="line">        <span class="string">&#x27;size&#x27;</span>     =&gt; <span class="variable">$_FILES</span>[<span class="string">&#x27;annex&#x27;</span>][<span class="string">&#x27;size&#x27;</span>][<span class="variable">$k</span>],</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$_FILES</span> = <span class="variable">$annex</span>;          <span class="comment">//用拼接好的数组去覆盖$_FILES</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$config</span>[<span class="string">&#x27;upload_path&#x27;</span>]      = <span class="keyword">$this</span>-&gt;config-&gt;item(<span class="string">&#x27;upload_path&#x27;</span>);</span><br><span class="line"><span class="variable">$config</span>[<span class="string">&#x27;allowed_types&#x27;</span>]    = <span class="string">&#x27;pdf&#x27;</span>;</span><br><span class="line"><span class="variable">$config</span>[<span class="string">&#x27;encrypt_name&#x27;</span>]     = <span class="literal">TRUE</span>;</span><br><span class="line"><span class="variable">$config</span>[<span class="string">&#x27;max_size&#x27;</span>]         = <span class="number">0</span>;</span><br><span class="line"><span class="variable">$config</span>[<span class="string">&#x27;file_ext_tolower&#x27;</span>] = <span class="literal">TRUE</span>;</span><br><span class="line"><span class="variable">$config</span>[<span class="string">&#x27;overwrite&#x27;</span>]        = <span class="literal">TRUE</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">$this</span>-&gt;load-&gt;library(<span class="string">&#x27;upload&#x27;</span>, <span class="variable">$config</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$annex</span> <span class="keyword">as</span> <span class="variable">$k</span> =&gt; <span class="variable">$v</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;upload-&gt;do_upload(<span class="variable">$k</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$filedata</span>[<span class="string">&#x27;annex_name&#x27;</span>]    = <span class="keyword">$this</span>-&gt;upload-&gt;data(<span class="string">&#x27;file_name&#x27;</span>);</span><br><span class="line">        <span class="variable">$filedata</span>[<span class="string">&#x27;annex_oldname&#x27;</span>] = <span class="keyword">$this</span>-&gt;upload-&gt;data(<span class="string">&#x27;orig_name&#x27;</span>);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;account_data-&gt;add_annex(<span class="variable">$filedata</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></p><p>这样就OK啦（逃……</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;好久没来写博客了。&lt;/p&gt;
&lt;p&gt;最近工作中遇到一个棘手的问题——CI框架的多文件上传，经过各种查资料+实践总算是解决了，觉得有必要记录一下遇到的一些坑。&lt;br&gt;
    
    </summary>
    
    
      <category term="实战经验" scheme="https://chaizi.one/categories/%E5%AE%9E%E6%88%98%E7%BB%8F%E9%AA%8C/"/>
    
    
      <category term="CI" scheme="https://chaizi.one/tags/CI/"/>
    
      <category term="PHP" scheme="https://chaizi.one/tags/PHP/"/>
    
  </entry>
  
  <entry>
    <title>Python实现电影更新自动发微博</title>
    <link href="https://chaizi.one/2016/12/14/Python%E5%AE%9E%E7%8E%B0%E7%94%B5%E5%BD%B1%E6%9B%B4%E6%96%B0%E8%87%AA%E5%8A%A8%E5%8F%91%E5%BE%AE%E5%8D%9A/"/>
    <id>https://chaizi.one/2016/12/14/Python%E5%AE%9E%E7%8E%B0%E7%94%B5%E5%BD%B1%E6%9B%B4%E6%96%B0%E8%87%AA%E5%8A%A8%E5%8F%91%E5%BE%AE%E5%8D%9A/</id>
    <published>2016-12-13T16:00:00.000Z</published>
    <updated>2020-02-29T13:09:53.471Z</updated>
    
    <content type="html"><![CDATA[<p>上一篇博客中我们实现了<a href="http://www.lalilali.com/" title="拉里拉里">拉里拉里</a>网页电影更新自动发邮件的提醒功能，但是代码的可拓展性不强，如果其他人也想要这个功能我还得修改源代码在里面加上收件人的邮箱，很是麻烦，而且如果一下子发好多邮件账号也有被封的风险，所以我就想能不能改用发微博的方式来解决这个问题，毕竟只要关注一下微博帐号就可以收到推送了……<br><span id="more"></span></p><p>微博官方是有相关API的，所以只要简单的照着官方文档写就可以了。</p><p>首先需要在微博开放平台申请到一个应用，获得应用的app_key和app_secret，这个后面代码里要用。然后，去应用信息-高级信息里面填写回调页，这是什么我也不知道但是照着填就好了，我填的是<a href="https://api.weibo.com/oauth2/default.html">https://api.weibo.com/oauth2/default.html</a> ，这个需要和代码里的callback_url一致。最后用pip装一下sinaweibopy这个库就可以来写代码了。</p><p>这里需要吐槽一下微博的API，我本来获取到的是图片的在线url，但是通过url发布带图片的微博需要高权限的API，而高权限就意味着要审核应用，我嫌麻烦，不想去申请审核应用，只能曲线救国一下，就是将图片先保存下来再发布，怎么感觉这个技俩我之前用过？</p><p>还有一个比较坑的，新浪会对某些关键词进行屏蔽，比如说<strong>在线观看地址</strong>，我之前发的微博中有这句话，结果发的微博只有自己能看到，其他账号都看不到，一开始以为是代码的问题，后来去掉这句话就好了。</p><p>其他好像也没什么有难度的地方，完整代码在下面。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding:UTF-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> weibo <span class="keyword">import</span> APIClient</span><br><span class="line"></span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">s = requests.Session()</span><br><span class="line"></span><br><span class="line">header = &#123;<span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/46.0.2490.76 Mobile Safari/537.36&#x27;</span>,</span><br><span class="line">          <span class="string">&#x27;Referer&#x27;</span>: <span class="string">&#x27;http://m.lalilali.com/&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">indexurl = <span class="string">&#x27;http://m.lalilali.com&#x27;</span></span><br><span class="line">url = <span class="string">&#x27;http://m.lalilali.com/vod-type-id-1-pg-1.html&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getsoup</span>():</span></span><br><span class="line">    r = s.get(url, headers=header)</span><br><span class="line">    <span class="keyword">return</span> BeautifulSoup(r.content, <span class="string">&#x27;html.parser&#x27;</span>, from_encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gettitles</span>(<span class="params">soup</span>):</span></span><br><span class="line">    b = soup.find_all(<span class="string">&#x27;span&#x27;</span>, class_=<span class="string">&#x27;sTit&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> b:</span><br><span class="line">        <span class="keyword">yield</span> i.a.string</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_access_token</span>(<span class="params">app_key, app_secret, callback_url</span>):</span></span><br><span class="line">    client = APIClient(app_key=app_key, app_secret=app_secret,</span><br><span class="line">                       redirect_uri=callback_url)</span><br><span class="line"></span><br><span class="line">    auth_url = client.get_authorize_url()</span><br><span class="line">    <span class="built_in">print</span> auth_url</span><br><span class="line"></span><br><span class="line">    code = raw_input(<span class="string">&quot;Input code:&quot;</span>)</span><br><span class="line">    r = client.request_access_token(code)</span><br><span class="line">    access_token = r.access_token</span><br><span class="line">    expires_in = r.expires_in</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&#x27;access_token:&#x27;</span>, access_token</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&#x27;expires_in:&#x27;</span>, expires_in</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> access_token, expires_in</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"></span><br><span class="line">    app_key = <span class="string">&#x27;xxx&#x27;</span></span><br><span class="line">    app_secret = <span class="string">&#x27;xxx&#x27;</span></span><br><span class="line">    callback_url = <span class="string">&#x27;https://api.weibo.com/oauth2/default.html&#x27;</span></span><br><span class="line"></span><br><span class="line">    access_token, expires_in = get_access_token(</span><br><span class="line">        app_key, app_secret, callback_url)</span><br><span class="line"></span><br><span class="line">    client = APIClient(app_key=app_key, app_secret=app_secret,</span><br><span class="line">                       redirect_uri=callback_url)</span><br><span class="line">    client.set_access_token(access_token, expires_in)</span><br><span class="line"></span><br><span class="line">    soup = getsoup()</span><br><span class="line">    titlelist = <span class="built_in">list</span>(gettitles(soup))</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            a = soup.find_all(<span class="string">&#x27;li&#x27;</span>)</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> i.img[<span class="string">&#x27;title&#x27;</span>] <span class="keyword">in</span> titlelist:</span><br><span class="line">                    msg = i.img[<span class="string">&#x27;title&#x27;</span>].decode(</span><br><span class="line">                        <span class="string">&#x27;utf-8&#x27;</span>) + <span class="string">&#x27;，豆瓣&#x27;</span> + i.div.span.string + <span class="string">&#x27;分http://www.lalilali.com&#x27;</span> + i.a[<span class="string">&#x27;href&#x27;</span>]</span><br><span class="line">                    <span class="built_in">print</span> msg</span><br><span class="line">                    req = requests.get(i.img[<span class="string">&#x27;src&#x27;</span>])</span><br><span class="line">                    <span class="keyword">with</span> <span class="built_in">open</span>(i.img[<span class="string">&#x27;title&#x27;</span>] + <span class="string">&#x27;.jpg&#x27;</span>, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> code:</span><br><span class="line">                        code.write(req.content)</span><br><span class="line">                    time.sleep(<span class="number">1</span>)</span><br><span class="line">                    f = <span class="built_in">open</span>(i.img[<span class="string">&#x27;title&#x27;</span>] + <span class="string">&#x27;.jpg&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>)</span><br><span class="line">                    r = client.statuses.upload.post(</span><br><span class="line">                        status=msg.decode(<span class="string">&#x27;utf-8&#x27;</span>), pic=f)</span><br><span class="line">                    f.close()</span><br><span class="line">                    <span class="built_in">print</span> i.img[<span class="string">&#x27;title&#x27;</span>]</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            titlelist = <span class="built_in">list</span>(gettitles(soup))</span><br><span class="line">            time.sleep(<span class="number">60</span>)</span><br><span class="line">            soup = getsoup()</span><br><span class="line">            <span class="built_in">print</span> time.ctime()</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&#x27;Error&#x27;</span></span><br><span class="line">            time.sleep(<span class="number">600</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>效果如图，</p><p><img src="https://i.imgur.com/AOXuFYM.png" alt=""></p><p>这还不赶紧关注一波？（逃……</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;上一篇博客中我们实现了&lt;a href=&quot;http://www.lalilali.com/&quot; title=&quot;拉里拉里&quot;&gt;拉里拉里&lt;/a&gt;网页电影更新自动发邮件的提醒功能，但是代码的可拓展性不强，如果其他人也想要这个功能我还得修改源代码在里面加上收件人的邮箱，很是麻烦，而且如果一下子发好多邮件账号也有被封的风险，所以我就想能不能改用发微博的方式来解决这个问题，毕竟只要关注一下微博帐号就可以收到推送了……&lt;br&gt;
    
    </summary>
    
    
      <category term="实战经验" scheme="https://chaizi.one/categories/%E5%AE%9E%E6%88%98%E7%BB%8F%E9%AA%8C/"/>
    
    
      <category term="Python" scheme="https://chaizi.one/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>Python实现电影更新自动邮箱提醒</title>
    <link href="https://chaizi.one/2016/12/11/Python%E5%AE%9E%E7%8E%B0%E7%94%B5%E5%BD%B1%E6%9B%B4%E6%96%B0%E8%87%AA%E5%8A%A8%E9%82%AE%E7%AE%B1%E6%8F%90%E9%86%92/"/>
    <id>https://chaizi.one/2016/12/11/Python%E5%AE%9E%E7%8E%B0%E7%94%B5%E5%BD%B1%E6%9B%B4%E6%96%B0%E8%87%AA%E5%8A%A8%E9%82%AE%E7%AE%B1%E6%8F%90%E9%86%92/</id>
    <published>2016-12-10T16:00:00.000Z</published>
    <updated>2020-02-29T13:09:59.667Z</updated>
    
    <content type="html"><![CDATA[<p><a href="http://www.lalilali.com/" title="拉里拉里">拉里拉里</a>是一个电影资源网站，每天都会更新一些比较新的电影，但是每天打开好多次网站就为了看自己想看的电影有没有更新是一件很累的事，我就想能不能用Python来实现电影更新自动提醒。<br><span id="more"></span></p><p>简单思路是这样的，用Python每隔一段时间去获取页面信息，然后跟之前获取的信息作比较，如果一样就不管，反之说明有更新，这时候把更新的信息发送到邮箱即可，包括电影名，豆瓣评分，海报图片以及链接地址。</p><p>Python的smtplib提供了一种很方便的途径发送电子邮件，它对SMTP协议进行了简单的封装，如果我们本机没有sendmail访问，可以使用其他邮件服务商的SMTP访问，我这里选用的是网易邮箱。</p><p>一开始我打算从网易邮箱发到QQ邮箱，单发文字邮件没什么问题，但后来在邮件中插入了图片就发不出去了，好像是因为反垃圾邮件机制的缘故，最后没办法暂时只能选择同一邮箱作为发件和收件邮箱。</p><p>邮件的HTML文本中一般邮件服务商添加外链是无效的，正确添加图片的示例如下面的代码所示。</p><blockquote><p>main.py</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding:UTF-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> mail</span><br><span class="line"></span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">s = requests.Session()</span><br><span class="line"></span><br><span class="line">header = &#123;<span class="string">&#x27;User-Agent&#x27;</span>:<span class="string">&#x27;Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/46.0.2490.76 Mobile Safari/537.36&#x27;</span>,<span class="string">&#x27;Referer&#x27;</span>:<span class="string">&#x27;http://m.lalilali.com/&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">indexurl = <span class="string">&#x27;http://m.lalilali.com&#x27;</span></span><br><span class="line">url = <span class="string">&#x27;http://m.lalilali.com/vod-type-id-1-pg-1.html&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getsoup</span>():</span></span><br><span class="line">    r = s.get(url,headers=header)</span><br><span class="line">    <span class="keyword">return</span> BeautifulSoup(r.content,<span class="string">&#x27;html.parser&#x27;</span>,from_encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gettitles</span>(<span class="params">soup</span>):</span></span><br><span class="line">    b = soup.find_all(<span class="string">&#x27;span&#x27;</span>, class_=<span class="string">&#x27;sTit&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> b:</span><br><span class="line">        <span class="keyword">yield</span> i.a.string</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__== <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    soup = getsoup()</span><br><span class="line">    titlelist = <span class="built_in">list</span>(gettitles(soup))</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            a = soup.find_all(<span class="string">&#x27;li&#x27;</span>)        </span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> i.img[<span class="string">&#x27;title&#x27;</span>] <span class="keyword">in</span> titlelist:</span><br><span class="line">                    mail.sendemail(i.img[<span class="string">&#x27;title&#x27;</span>],i.div.span.string,i.a[<span class="string">&#x27;href&#x27;</span>],i.img[<span class="string">&#x27;src&#x27;</span>])</span><br><span class="line">                    <span class="built_in">print</span> i.img[<span class="string">&#x27;title&#x27;</span>]</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            titlelist = <span class="built_in">list</span>(gettitles(soup))</span><br><span class="line">            time.sleep(<span class="number">60</span>)</span><br><span class="line">            soup = getsoup()</span><br><span class="line">            <span class="built_in">print</span> time.ctime()</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            time.sleep(<span class="number">600</span>)</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&#x27;error&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>mail.py</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> smtplib</span><br><span class="line"><span class="keyword">from</span> email.mime.image <span class="keyword">import</span> MIMEImage</span><br><span class="line"><span class="keyword">from</span> email.mime.multipart <span class="keyword">import</span> MIMEMultipart</span><br><span class="line"><span class="keyword">from</span> email.mime.text <span class="keyword">import</span> MIMEText</span><br><span class="line"><span class="keyword">from</span> email.header <span class="keyword">import</span> Header</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">mail_host=<span class="string">&#x27;smtp.xxx.com&#x27;</span> <span class="comment"># 设置服务器</span></span><br><span class="line">mail_user=<span class="string">&#x27;xxx&#x27;</span> <span class="comment"># 用户名</span></span><br><span class="line">mail_pass=<span class="string">&#x27;xxx&#x27;</span> <span class="comment"># 密码</span></span><br><span class="line"></span><br><span class="line">sender = <span class="string">&#x27;xxx&#x27;</span> <span class="comment"># 发送邮箱</span></span><br><span class="line">receivers = [<span class="string">&#x27;xxx&#x27;</span>] <span class="comment"># 接收邮箱</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sendemail</span>(<span class="params">title,score,url,imgurl</span>):</span></span><br><span class="line"></span><br><span class="line">    msgRoot = MIMEMultipart()</span><br><span class="line">    msgRoot[<span class="string">&#x27;From&#x27;</span>] = <span class="string">&#x27;lalilali &lt;xxx&gt;&#x27;</span> <span class="comment"># 发送邮箱</span></span><br><span class="line">    msgRoot[<span class="string">&#x27;To&#x27;</span>] = <span class="string">&#x27;xxx&#x27;</span> <span class="comment"># 接收邮箱</span></span><br><span class="line"></span><br><span class="line">    msgRoot[<span class="string">&#x27;Subject&#x27;</span>] = Header(title+<span class="string">&#x27; &#x27;</span>+score+<span class="string">u&#x27;分&#x27;</span>, <span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    msgAlternative = MIMEMultipart(<span class="string">&#x27;alternative&#x27;</span>)</span><br><span class="line">    msgRoot.attach(msgAlternative)</span><br><span class="line"></span><br><span class="line">    mail_msg = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    &lt;h1&gt;%s&lt;/h1&gt;</span></span><br><span class="line"><span class="string">    &lt;p&gt;豆瓣：%s分&lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;p&gt;&lt;a href=&quot;http://www.lalilali.com%s&quot;&gt;在线观看地址&lt;/a&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;p&gt;&lt;img src=&quot;cid:image1&quot;&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span> % (title,score,url)</span><br><span class="line"></span><br><span class="line">    msgAlternative.attach(MIMEText(mail_msg, <span class="string">&#x27;html&#x27;</span>, <span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 指定图片为当前目录</span></span><br><span class="line">    fp = requests.get(imgurl)</span><br><span class="line">    msgImage = MIMEImage(fp.content)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 定义图片ID，在HTML 文本中引用</span></span><br><span class="line">    msgImage.add_header(<span class="string">&#x27;Content-ID&#x27;</span>, <span class="string">&#x27;&lt;image1&gt;&#x27;</span>)</span><br><span class="line">    msgRoot.attach(msgImage)</span><br><span class="line"></span><br><span class="line">    smtpObj = smtplib.SMTP(mail_host,<span class="string">&#x27;25&#x27;</span>) </span><br><span class="line">    smtpObj.login(mail_user,mail_pass)  </span><br><span class="line">    smtpObj.sendmail(sender, receivers, msgRoot.as_string())</span><br><span class="line">    smtpObj.quit()</span><br></pre></td></tr></table></figure><p>效果如图，</p><p><img src="https://i.imgur.com/FKp1Rs4.png" alt=""></p><p><img src="https://i.imgur.com/hvbgDOH.png" alt=""></p><p>小结一下，</p><ol><li><p>一开始爬取的是拉里拉里的电脑版页面，用BeautifulSoup匹配得很蛋疼，后来发现手机版的页面简单得多，但是获取页面时要指定一下User-Agent不然可能会不成功。</p></li><li><p>设置的1分钟去获取一次页面数据，但是过一会就会抛异常退出，我猜可能是把我误认为是Dos攻击了，然后我加了一个异常处理，遇到异常停10分钟再去获取，目前运行良好.</p></li><li><p>发邮件只能满足个人需求，后面看能不能改成自动发微博这样大家就可以用啦……</p></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;http://www.lalilali.com/&quot; title=&quot;拉里拉里&quot;&gt;拉里拉里&lt;/a&gt;是一个电影资源网站，每天都会更新一些比较新的电影，但是每天打开好多次网站就为了看自己想看的电影有没有更新是一件很累的事，我就想能不能用Python来实现电影更新自动提醒。&lt;br&gt;
    
    </summary>
    
    
      <category term="实战经验" scheme="https://chaizi.one/categories/%E5%AE%9E%E6%88%98%E7%BB%8F%E9%AA%8C/"/>
    
    
      <category term="Python" scheme="https://chaizi.one/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>Python+Django实现教务系统api</title>
    <link href="https://chaizi.one/2016/11/23/Python+Django%E5%AE%9E%E7%8E%B0%E6%95%99%E5%8A%A1%E7%B3%BB%E7%BB%9Fapi/"/>
    <id>https://chaizi.one/2016/11/23/Python+Django%E5%AE%9E%E7%8E%B0%E6%95%99%E5%8A%A1%E7%B3%BB%E7%BB%9Fapi/</id>
    <published>2016-11-22T16:00:00.000Z</published>
    <updated>2020-02-29T13:09:05.051Z</updated>
    
    <content type="html"><![CDATA[<p>前两天有小伙伴看到了我的网站<a href="http://njnu.chaiziyi.com.cn/" title="http://njnu.chaiziyi.com.cn/">查南师，你想要的信息都在这里！</a>，想做个类似的安卓app玩玩，问我有没有api接口，因为当时没考虑这么多，前后端写在了一起也就没有api一说，不过既然人家都这么说了，干脆就来写个api吧，也方便后面自己做点其他好玩的东西。<br><span id="more"></span></p><p>因为主要是提供api接口，所以前端页面就只写了个主页用来介绍api的使用方法。</p><p><img src="https://i.imgur.com/C0uHOTh.png" alt=""></p><p>目前一共是有4个api，包括登录、基本信息、学业成绩和课表查询，具体的使用说明可以去<a href="http://api.chaiziyi.com.cn/jwgl/" title="南师大教务系统API使用说明">南师大教务系统API使用说明</a>上看，这里就不赘述了，谈一下用到的一些新东西。</p><p>第一个是python的xmltodict库，用来将xml格式的文字转成字典，然后可以再用json库的dumps函数将字典转成json，这里的基本信息api就是用的这个，比自己手动去解析要方便很多。</p><p>第二个，教务系统查询课表时参数用了base64编码，我一开始想直接用<code>base64.b64encode()</code>对提交数据进行编码发现报错，查了一下python3里面这个函数有了一点点不同，之前python2是可以直接对str进行编码的，但是现在python3不行了，得先对字符串进行utf-8编码，又学了一个新知识。</p><p>第三个，在Django里面，获取request里面的cookie用的是<code>request.COOKIES</code>，设置cookie要用<code>response.set_cookie</code>，这里response是一个事先定义的HttpResponse对象。</p><p>最后一个，在return时加上<code>content_type=&quot;application/json&quot;</code>才会返回我们所希望的json格式的数据，否则返回的数据格式会是默认的<code>text/html</code>。</p><p>见Github:<a href="https://github.com/crazyczy/njnu-jwgl-api" title="njnu-jwgl-api">njnu-jwgl-api</a></p><p>有了api好像又可以干一些好玩的事了，我真是个闲不下来的人啊（逃……</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;前两天有小伙伴看到了我的网站&lt;a href=&quot;http://njnu.chaiziyi.com.cn/&quot; title=&quot;http://njnu.chaiziyi.com.cn/&quot;&gt;查南师，你想要的信息都在这里！&lt;/a&gt;，想做个类似的安卓app玩玩，问我有没有api接口，因为当时没考虑这么多，前后端写在了一起也就没有api一说，不过既然人家都这么说了，干脆就来写个api吧，也方便后面自己做点其他好玩的东西。&lt;br&gt;
    
    </summary>
    
    
      <category term="项目成果" scheme="https://chaizi.one/categories/%E9%A1%B9%E7%9B%AE%E6%88%90%E6%9E%9C/"/>
    
    
      <category term="Python" scheme="https://chaizi.one/tags/Python/"/>
    
      <category term="Django" scheme="https://chaizi.one/tags/Django/"/>
    
      <category term="api" scheme="https://chaizi.one/tags/api/"/>
    
  </entry>
  
  <entry>
    <title>Python+Django实现个人信息查询网站（三）</title>
    <link href="https://chaizi.one/2016/11/18/Python+Django%E5%AE%9E%E7%8E%B0%E4%B8%AA%E4%BA%BA%E4%BF%A1%E6%81%AF%E6%9F%A5%E8%AF%A2%E7%BD%91%E7%AB%99%EF%BC%88%E4%B8%89%EF%BC%89/"/>
    <id>https://chaizi.one/2016/11/18/Python+Django%E5%AE%9E%E7%8E%B0%E4%B8%AA%E4%BA%BA%E4%BF%A1%E6%81%AF%E6%9F%A5%E8%AF%A2%E7%BD%91%E7%AB%99%EF%BC%88%E4%B8%89%EF%BC%89/</id>
    <published>2016-11-17T16:00:00.000Z</published>
    <updated>2020-02-29T13:08:33.387Z</updated>
    
    <content type="html"><![CDATA[<p>上次FACE++申请的上线版竟然通过了，真开心，于是迫不及待地在<del>查南师(已过期)</del>里面加上了以图找人的功能。<br><span id="more"></span></p><p>先放一张申请通过的上线版的图开心一下</p><p><img src="https://i.imgur.com/7R7o6xk.png" alt=""></p><p>其实这个所谓的以图找人功能并没有什么难度，都是调用的FACE++的api，要说遇到的最大的困难可能就是我的Django是写在Python3环境下的，而FACE++却不支持Python3，所以我只能手动去调用接口而不能直接用官方现成的SDK，有点难过……</p><p>图片来源可以是在线URL也可以是本地上传的图片，在线URL很好写，直接传URL给接口就好了，但是本地上传的要传图片的二进制文件给接口，在官方的SDK有一个现成的File函数可以转换，但我这里用不了就有点棘手，于是我想了一个讨巧的办法就是把图片先保存到服务器这时候就有了图片的URL再调用第一个接口就完美解决了。</p><p>下面一段就是手动去调用接口的代码，因为一个GROUP只能存10000个Person，所以我只能分成多个GROUP来存，然后分别在每个GROUP中找出最相似的3个人最后按照相似度给所有的人排个序并返回最相似的10个人的信息。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">API_KEY = <span class="string">&#x27;xxx&#x27;</span></span><br><span class="line">API_SECRET = <span class="string">&#x27;xxx&#x27;</span></span><br><span class="line"></span><br><span class="line">s = requests.Session()</span><br><span class="line"></span><br><span class="line">apiurl = <span class="string">&#x27;https://apicn.faceplusplus.com/v2/&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">facebyurl</span>(<span class="params">url</span>):</span></span><br><span class="line">    li = <span class="built_in">list</span>()</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;api_key&#x27;</span> : API_KEY,</span><br><span class="line">        <span class="string">&#x27;api_secret&#x27;</span> : API_SECRET</span><br><span class="line">    &#125;</span><br><span class="line">    grouplist = s.get(apiurl+<span class="string">&#x27;info/get_group_list&#x27;</span>,params=data).json()</span><br><span class="line">    <span class="keyword">for</span> each <span class="keyword">in</span> grouplist[<span class="string">&#x27;group&#x27;</span>]:</span><br><span class="line">        data = &#123;</span><br><span class="line">        <span class="string">&#x27;url&#x27;</span>:url,</span><br><span class="line">        <span class="string">&#x27;api_key&#x27;</span> : API_KEY,</span><br><span class="line">        <span class="string">&#x27;api_secret&#x27;</span> : API_SECRET,</span><br><span class="line">        <span class="string">&#x27;group_name&#x27;</span>:each[<span class="string">&#x27;group_name&#x27;</span>]</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            r = s.get(apiurl+<span class="string">&#x27;recognition/identify&#x27;</span>,params=data)</span><br><span class="line">            li += (r.json()[<span class="string">&#x27;face&#x27;</span>][<span class="number">0</span>][<span class="string">&#x27;candidate&#x27;</span>])</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sorted</span>(li,key=<span class="keyword">lambda</span> x:x[<span class="string">&#x27;confidence&#x27;</span>],reverse = <span class="literal">True</span>)[<span class="number">0</span>:<span class="number">10</span>]</span><br></pre></td></tr></table></figure><p>这一张是用的本来里面的证件照，相似度不是100的原因是一个Person可能不止一张照片，识别的时候都会考虑到。</p><p><img src="https://i.imgur.com/1TnunsE.png" alt=""></p><p>本地传的照片就没有那么高的识别率了，但还是能准确识别出照片里的小伙伴，说实话其他人长得跟他还真的挺像的。</p><p><img src="https://i.imgur.com/QkVtGu3.png" alt=""></p><p>可能是分了多个GROUP的缘故，每次查询都特别慢，甚至接近30s，用户体验大打折扣，看后面能不能自己搞个机器学习算法提高点速度，暂时就这样吧。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;上次FACE++申请的上线版竟然通过了，真开心，于是迫不及待地在&lt;del&gt;查南师(已过期)&lt;/del&gt;里面加上了以图找人的功能。&lt;br&gt;
    
    </summary>
    
    
      <category term="项目成果" scheme="https://chaizi.one/categories/%E9%A1%B9%E7%9B%AE%E6%88%90%E6%9E%9C/"/>
    
    
      <category term="Python" scheme="https://chaizi.one/tags/Python/"/>
    
      <category term="Django" scheme="https://chaizi.one/tags/Django/"/>
    
      <category term="Face++" scheme="https://chaizi.one/tags/Face/"/>
    
  </entry>
  
  <entry>
    <title>从美国大面积断网谈学校物联网设备安全</title>
    <link href="https://chaizi.one/2016/11/15/%E4%BB%8E%E7%BE%8E%E5%9B%BD%E5%A4%A7%E9%9D%A2%E7%A7%AF%E6%96%AD%E7%BD%91%E8%B0%88%E5%AD%A6%E6%A0%A1%E7%89%A9%E8%81%94%E7%BD%91%E8%AE%BE%E5%A4%87%E5%AE%89%E5%85%A8/"/>
    <id>https://chaizi.one/2016/11/15/%E4%BB%8E%E7%BE%8E%E5%9B%BD%E5%A4%A7%E9%9D%A2%E7%A7%AF%E6%96%AD%E7%BD%91%E8%B0%88%E5%AD%A6%E6%A0%A1%E7%89%A9%E8%81%94%E7%BD%91%E8%AE%BE%E5%A4%87%E5%AE%89%E5%85%A8/</id>
    <published>2016-11-14T16:00:00.000Z</published>
    <updated>2020-02-29T13:10:25.266Z</updated>
    
    <content type="html"><![CDATA[<p>上个月21号美国大部分地区都遭受了网络中断的问题，原因是Dyn的服务器遭受了黑客的DDoS攻击，大量的攻击来自智能设备，也就是所谓的物联网设备。<br><span id="more"></span></p><p>更准确点讲，这次的事件是物联网设备的弱密码所致，这让我意识到我们身边可能也存在着大量使用弱密码的物联网设备，于是我用nmap扫了一下学校服务器的端口，然后找出可能的服务器再用弱密码一试，真的是吓了一跳。</p><p><img src="https://i.imgur.com/wKMMHDr.png" alt=""></p><p>上面截的那张图片只是众多摄像头服务器中的一个，挑这个是因为我觉得这张最具有代表性，这些机房是我们平时上机的地方，更是江苏省高考数学阅卷的地方，这么重要的地方都不注意摄像头安全，不能不让人担心。</p><p>出于安全考虑，怎么扫描然后找出这些服务器的步骤就不贴出来了，大家看看就好。</p><p>随着人们越来越依赖互联网，网络安全变得尤为重要。而随着智能设备的增加，智能设备的安全漏洞也日益严重，这里只想提醒大家千万不要为了方便而去使用弱密码，说不定哪一天你的设备就变成了别人用来发动DDoS攻击的肉鸡。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;上个月21号美国大部分地区都遭受了网络中断的问题，原因是Dyn的服务器遭受了黑客的DDoS攻击，大量的攻击来自智能设备，也就是所谓的物联网设备。&lt;br&gt;
    
    </summary>
    
    
      <category term="日常心得" scheme="https://chaizi.one/categories/%E6%97%A5%E5%B8%B8%E5%BF%83%E5%BE%97/"/>
    
    
      <category term="nmap" scheme="https://chaizi.one/tags/nmap/"/>
    
      <category term="其他" scheme="https://chaizi.one/tags/%E5%85%B6%E4%BB%96/"/>
    
  </entry>
  
  <entry>
    <title>用微软小冰的颜值打分接口为证件照打分</title>
    <link href="https://chaizi.one/2016/11/13/%E7%94%A8%E5%BE%AE%E8%BD%AF%E5%B0%8F%E5%86%B0%E7%9A%84%E9%A2%9C%E5%80%BC%E6%89%93%E5%88%86%E6%8E%A5%E5%8F%A3%E4%B8%BA%E8%AF%81%E4%BB%B6%E7%85%A7%E6%89%93%E5%88%86/"/>
    <id>https://chaizi.one/2016/11/13/%E7%94%A8%E5%BE%AE%E8%BD%AF%E5%B0%8F%E5%86%B0%E7%9A%84%E9%A2%9C%E5%80%BC%E6%89%93%E5%88%86%E6%8E%A5%E5%8F%A3%E4%B8%BA%E8%AF%81%E4%BB%B6%E7%85%A7%E6%89%93%E5%88%86/</id>
    <published>2016-11-12T16:00:00.000Z</published>
    <updated>2020-02-29T13:13:05.747Z</updated>
    
    <content type="html"><![CDATA[<p>之前想为爬的证件照做个颜值打分程序来着，奈何水平有限，对机器学习知之甚少，就一直搁置着没有做。前两天才想起来微软的人工智能小冰好像可以给照片打分，那干脆就先利用小冰做个简单的颜值打分吧。<br><span id="more"></span></p><p><a href="http://kan.msxiaobing.com/V3/Portal" title="http://kan.msxiaobing.com/V3/Portal">http://kan.msxiaobing.com/V3/Portal</a>就是微软小冰用来给照片打分的网址了，我们打开F12开发者工具，然后提交一张照片并观察整个过程。</p><p>主要的步骤有两个，一是上传图片，这里网页上将图片文件先转换成二进制然后进行Base64编码最后提交，返回了一个图片的在线地址，二是分析图片，这里提交的data里面就包括了刚刚返回的图片地址，这时候会返回一堆数据，其中对我们有用的除了分数那一项，还有打分后的图片地址，就是在照片上加上一个带分数的框框的图片。</p><p>明白了基本原理以后，代码写起来就简单多了。这里我们将分数的结果写入到了csv文件里面，然后用一个文件夹保存了带有分数的照片。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="string">&#x27;images&#x27;</span>):</span><br><span class="line">    os.mkdir(<span class="string">&quot;images&quot;</span>)</span><br><span class="line"></span><br><span class="line">header = &#123;</span><br><span class="line">        <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/47.0.2526.73 Safari/537.36&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Referer&#x27;</span>: <span class="string">&#x27;http://kan.msxiaobing.com/V3/Portal&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">url1 = <span class="string">&#x27;http://kan.msxiaobing.com/Api/Image/UploadBase64&#x27;</span></span><br><span class="line">url2 = <span class="string">&#x27;http://kan.msxiaobing.com/Api/ImageAnalyze/Process?service=beauty&amp;tid=1f8af41c7a3b49cd8bcb9ea2f003de1d&#x27;</span></span><br><span class="line"></span><br><span class="line">s = requests.Session()</span><br><span class="line"></span><br><span class="line">csvfile = file(<span class="string">&#x27;info.csv&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>)</span><br><span class="line"></span><br><span class="line">photo_path = <span class="string">&#x27;F:/img&#x27;</span></span><br><span class="line"><span class="keyword">for</span> path, subdirs, files <span class="keyword">in</span> os.walk(photo_path):</span><br><span class="line">    <span class="comment"># print path, subdirs, files</span></span><br><span class="line">    <span class="keyword">for</span> img <span class="keyword">in</span> files:</span><br><span class="line"></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(path + <span class="string">&#x27;/&#x27;</span> + img, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            image_data = f.read().encode(<span class="string">&#x27;base64&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            r = s.post(url1, data=image_data, headers=header)</span><br><span class="line">            res = json.loads(r.text)</span><br><span class="line">            data = &#123;</span><br><span class="line">                <span class="string">&#x27;MsgId&#x27;</span>: <span class="built_in">int</span>(<span class="built_in">round</span>(time.time() * <span class="number">1000</span>)),</span><br><span class="line">                <span class="string">&#x27;CreateTime&#x27;</span>: <span class="built_in">int</span>(time.time()),</span><br><span class="line">                <span class="string">&#x27;content[imageUrl]&#x27;</span>: res[<span class="string">&#x27;Host&#x27;</span>] + res[<span class="string">&#x27;Url&#x27;</span>] </span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            r = s.post(url2, data=data, headers=header)</span><br><span class="line">            res = json.loads(r.text)</span><br><span class="line">            imageUrl = res[<span class="string">&#x27;content&#x27;</span>][<span class="string">&#x27;imageUrl&#x27;</span>]</span><br><span class="line">            req = s.get(imageUrl)</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;images/&#x27;</span> + img, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> code:</span><br><span class="line">                code.write(req.content)</span><br><span class="line">            writer = csv.writer(csvfile)</span><br><span class="line">            writer.writerow([img,res[<span class="string">&#x27;content&#x27;</span>][<span class="string">&#x27;metadata&#x27;</span>][<span class="string">&#x27;FBR_Score0&#x27;</span>]])</span><br><span class="line">            <span class="built_in">print</span> img</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">csvfile.close()</span><br></pre></td></tr></table></figure><p>可能是审美有别吧，试了一些照片总觉得小冰打出来的分数跟我的审美有些不符，加上打分太慢了，这几万张证件照还不知道要跑到什么时候，所以先这样了，等后面有时间可以考虑来写一个有监督的机器学习颜值打分程序……</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;之前想为爬的证件照做个颜值打分程序来着，奈何水平有限，对机器学习知之甚少，就一直搁置着没有做。前两天才想起来微软的人工智能小冰好像可以给照片打分，那干脆就先利用小冰做个简单的颜值打分吧。&lt;br&gt;
    
    </summary>
    
    
      <category term="实战经验" scheme="https://chaizi.one/categories/%E5%AE%9E%E6%88%98%E7%BB%8F%E9%AA%8C/"/>
    
    
      <category term="Python" scheme="https://chaizi.one/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>初识FACE++</title>
    <link href="https://chaizi.one/2016/11/12/%E5%88%9D%E8%AF%86FACE++/"/>
    <id>https://chaizi.one/2016/11/12/%E5%88%9D%E8%AF%86FACE++/</id>
    <published>2016-11-11T16:00:00.000Z</published>
    <updated>2020-02-29T13:10:39.008Z</updated>
    
    <content type="html"><![CDATA[<p>之前爬了学校的好多证件照，想着能不能做个人脸识别，如果顺利的话说不定还能整合到上次那个网站里面做个以图找人的功能。查了一下，发现了FACE++这个好东西。<br><span id="more"></span></p><p><img src="https://i.imgur.com/yjn0zeN.png" alt=""></p><p><a href="http://www.faceplusplus.com.cn/" title="FACE++">FACE++</a>提供了免费的API接口，可以很方便的对人脸进行识别分析，而且官方也提供了<a href="https://github.com/FacePlusPlus/facepp-python-sdk/tree/v2.0" title="Python SDK &amp; 命令行工具">Python SDK &amp; 命令行工具</a>，正合我意。</p><p>但是现在还有一个问题，我要做的人脸识别程序需要将数万张证件照都导入进去然后训练，但是现在的权限是开发版，好像只能存储100个人的信息，这对于我要做的人脸识别来说是远远不够的，所以我只能抱着试试看的态度申请了一下上线版，这个版本是没有权限限制的，但是目前还显示在审核中，感觉有点悬……</p><p>趁着还在审核中，不妨先来简单练练手，比方说第一个API <code>/detection/detect</code>，功能是检测一张照片中的人脸信息（脸部位置、年龄、种族、性别等等），我就想不如来写个循环，把所有照片的信息识别出来然后保存到文件中，代码如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line">API_KEY = <span class="string">&#x27;xxx&#x27;</span></span><br><span class="line">API_SECRET = <span class="string">&#x27;xxx&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> facepp <span class="keyword">import</span> API,File</span><br><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"></span><br><span class="line">api = API(API_KEY, API_SECRET)</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;img/&#x27;</span></span><br><span class="line"></span><br><span class="line">reader = csv.reader(<span class="built_in">open</span>(<span class="string">&#x27;id.csv&#x27;</span>))</span><br><span class="line">csvfile = file(<span class="string">&#x27;info.csv&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> <span class="built_in">id</span> <span class="keyword">in</span> reader:</span><br><span class="line">    path = url + <span class="built_in">id</span>[<span class="number">0</span>] + <span class="string">&#x27;.jpg&#x27;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        face = api.detection.detect(img = File(path),model=<span class="string">&#x27;oneface&#x27;</span> ,attribute=[<span class="string">&#x27;gender&#x27;</span>, <span class="string">&#x27;age&#x27;</span>, <span class="string">&#x27;race&#x27;</span>, <span class="string">&#x27;smiling&#x27;</span>, <span class="string">&#x27;glass&#x27;</span>])</span><br><span class="line"></span><br><span class="line">        li = <span class="built_in">list</span>()</span><br><span class="line">        li.append(<span class="built_in">id</span>[<span class="number">0</span>])</span><br><span class="line">        li.append(face[<span class="string">&#x27;img_width&#x27;</span>])</span><br><span class="line">        li.append(face[<span class="string">&#x27;img_height&#x27;</span>])</span><br><span class="line">        li.append(face[<span class="string">&#x27;face&#x27;</span>][<span class="number">0</span>][<span class="string">&#x27;position&#x27;</span>][<span class="string">&#x27;width&#x27;</span>])</span><br><span class="line">        li.append(face[<span class="string">&#x27;face&#x27;</span>][<span class="number">0</span>][<span class="string">&#x27;position&#x27;</span>][<span class="string">&#x27;height&#x27;</span>])</span><br><span class="line">        li.append(face[<span class="string">&#x27;face&#x27;</span>][<span class="number">0</span>][<span class="string">&#x27;attribute&#x27;</span>][<span class="string">&#x27;gender&#x27;</span>][<span class="string">&#x27;confidence&#x27;</span>])</span><br><span class="line">        li.append(face[<span class="string">&#x27;face&#x27;</span>][<span class="number">0</span>][<span class="string">&#x27;attribute&#x27;</span>][<span class="string">&#x27;gender&#x27;</span>][<span class="string">&#x27;value&#x27;</span>])</span><br><span class="line">        li.append(face[<span class="string">&#x27;face&#x27;</span>][<span class="number">0</span>][<span class="string">&#x27;attribute&#x27;</span>][<span class="string">&#x27;age&#x27;</span>][<span class="string">&#x27;range&#x27;</span>])</span><br><span class="line">        li.append(face[<span class="string">&#x27;face&#x27;</span>][<span class="number">0</span>][<span class="string">&#x27;attribute&#x27;</span>][<span class="string">&#x27;age&#x27;</span>][<span class="string">&#x27;value&#x27;</span>])</span><br><span class="line">        li.append(face[<span class="string">&#x27;face&#x27;</span>][<span class="number">0</span>][<span class="string">&#x27;attribute&#x27;</span>][<span class="string">&#x27;race&#x27;</span>][<span class="string">&#x27;confidence&#x27;</span>])</span><br><span class="line">        li.append(face[<span class="string">&#x27;face&#x27;</span>][<span class="number">0</span>][<span class="string">&#x27;attribute&#x27;</span>][<span class="string">&#x27;race&#x27;</span>][<span class="string">&#x27;value&#x27;</span>])</span><br><span class="line">        li.append(face[<span class="string">&#x27;face&#x27;</span>][<span class="number">0</span>][<span class="string">&#x27;attribute&#x27;</span>][<span class="string">&#x27;glass&#x27;</span>][<span class="string">&#x27;confidence&#x27;</span>])</span><br><span class="line">        li.append(face[<span class="string">&#x27;face&#x27;</span>][<span class="number">0</span>][<span class="string">&#x27;attribute&#x27;</span>][<span class="string">&#x27;glass&#x27;</span>][<span class="string">&#x27;value&#x27;</span>])</span><br><span class="line">        li.append(face[<span class="string">&#x27;face&#x27;</span>][<span class="number">0</span>][<span class="string">&#x27;attribute&#x27;</span>][<span class="string">&#x27;smiling&#x27;</span>][<span class="string">&#x27;value&#x27;</span>])</span><br><span class="line">        li.append(face[<span class="string">&#x27;face&#x27;</span>][<span class="number">0</span>][<span class="string">&#x27;position&#x27;</span>][<span class="string">&#x27;eye_left&#x27;</span>][<span class="string">&#x27;y&#x27;</span>])</span><br><span class="line">        li.append(face[<span class="string">&#x27;face&#x27;</span>][<span class="number">0</span>][<span class="string">&#x27;position&#x27;</span>][<span class="string">&#x27;eye_left&#x27;</span>][<span class="string">&#x27;x&#x27;</span>])</span><br><span class="line">        li.append(face[<span class="string">&#x27;face&#x27;</span>][<span class="number">0</span>][<span class="string">&#x27;position&#x27;</span>][<span class="string">&#x27;eye_right&#x27;</span>][<span class="string">&#x27;y&#x27;</span>])</span><br><span class="line">        li.append(face[<span class="string">&#x27;face&#x27;</span>][<span class="number">0</span>][<span class="string">&#x27;position&#x27;</span>][<span class="string">&#x27;eye_right&#x27;</span>][<span class="string">&#x27;x&#x27;</span>])</span><br><span class="line">        li.append(face[<span class="string">&#x27;face&#x27;</span>][<span class="number">0</span>][<span class="string">&#x27;position&#x27;</span>][<span class="string">&#x27;mouth_left&#x27;</span>][<span class="string">&#x27;y&#x27;</span>])</span><br><span class="line">        li.append(face[<span class="string">&#x27;face&#x27;</span>][<span class="number">0</span>][<span class="string">&#x27;position&#x27;</span>][<span class="string">&#x27;mouth_left&#x27;</span>][<span class="string">&#x27;x&#x27;</span>])</span><br><span class="line">        li.append(face[<span class="string">&#x27;face&#x27;</span>][<span class="number">0</span>][<span class="string">&#x27;position&#x27;</span>][<span class="string">&#x27;mouth_right&#x27;</span>][<span class="string">&#x27;y&#x27;</span>])</span><br><span class="line">        li.append(face[<span class="string">&#x27;face&#x27;</span>][<span class="number">0</span>][<span class="string">&#x27;position&#x27;</span>][<span class="string">&#x27;mouth_right&#x27;</span>][<span class="string">&#x27;x&#x27;</span>])</span><br><span class="line">        li.append(face[<span class="string">&#x27;face&#x27;</span>][<span class="number">0</span>][<span class="string">&#x27;position&#x27;</span>][<span class="string">&#x27;center&#x27;</span>][<span class="string">&#x27;y&#x27;</span>])</span><br><span class="line">        li.append(face[<span class="string">&#x27;face&#x27;</span>][<span class="number">0</span>][<span class="string">&#x27;position&#x27;</span>][<span class="string">&#x27;center&#x27;</span>][<span class="string">&#x27;x&#x27;</span>])</span><br><span class="line">        li.append(face[<span class="string">&#x27;face&#x27;</span>][<span class="number">0</span>][<span class="string">&#x27;position&#x27;</span>][<span class="string">&#x27;nose&#x27;</span>][<span class="string">&#x27;y&#x27;</span>])</span><br><span class="line">        li.append(face[<span class="string">&#x27;face&#x27;</span>][<span class="number">0</span>][<span class="string">&#x27;position&#x27;</span>][<span class="string">&#x27;nose&#x27;</span>][<span class="string">&#x27;x&#x27;</span>])</span><br><span class="line">        writer = csv.writer(csvfile)</span><br><span class="line">        writer.writerow(li)</span><br><span class="line">        <span class="built_in">print</span> <span class="built_in">id</span>[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">csvfile.close()</span><br></pre></td></tr></table></figure><p>总的来说识别识别还算准确，根据识别后的数据做了两张男女性别比例的图表，跟事实情况应该差不太多，感受一下我大南师可怕的男女比例。</p><p><img src="https://i.imgur.com/SDD1fgJ.png" alt=""></p><p>以及我们学院与学校大环境格格不入的男女比例。</p><p><img src="https://i.imgur.com/HhRSm1V.png" alt=""></p><p>希望上线版的审核能过吧，要不然真的只能做个简单版的人脸识别玩玩了。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;之前爬了学校的好多证件照，想着能不能做个人脸识别，如果顺利的话说不定还能整合到上次那个网站里面做个以图找人的功能。查了一下，发现了FACE++这个好东西。&lt;br&gt;
    
    </summary>
    
    
      <category term="实战经验" scheme="https://chaizi.one/categories/%E5%AE%9E%E6%88%98%E7%BB%8F%E9%AA%8C/"/>
    
    
      <category term="Python" scheme="https://chaizi.one/tags/Python/"/>
    
      <category term="Face++" scheme="https://chaizi.one/tags/Face/"/>
    
  </entry>
  
  <entry>
    <title>Nginx+uWSGI+Django部署小记</title>
    <link href="https://chaizi.one/2016/11/09/Nginx+uWSGI+Django%E9%83%A8%E7%BD%B2%E5%B0%8F%E8%AE%B0/"/>
    <id>https://chaizi.one/2016/11/09/Nginx+uWSGI+Django%E9%83%A8%E7%BD%B2%E5%B0%8F%E8%AE%B0/</id>
    <published>2016-11-08T16:00:00.000Z</published>
    <updated>2020-02-29T13:08:09.184Z</updated>
    
    <content type="html"><![CDATA[<p>写网站，部署永远是一个回避不了而且让人头疼的问题，为了方便自己以后部署，这里把部署的过程以及遇到的坑记下来。<br><span id="more"></span></p><p>这里强烈推荐一下腾讯云的云+校园计划，服务器1块钱一个月，域名还不要钱，虽然配置低了点，不过拿来练手足够了。</p><p>装上Ubuntu14.04的系统，我们就可以开始部署我们的Django工程了。</p><p>为了避免部署的多个工程之间互相干扰，我们需要为每一个工程创建单独的环境。之前用过virtualenv，后来发现了更好用的anaconda就果断抛弃了virtualenv。</p><h2 id="1-安装Anaconda"><a href="#1-安装Anaconda" class="headerlink" title="1. 安装Anaconda"></a>1. 安装Anaconda</h2><p>在<a href="https://www.continuum.io/downloads#linux" title="官网">官网</a>下载最新版的Anaconda For Linux，我这里是4.2.0版本</p><pre><code>wget https://repo.continuum.io/archive/Anaconda3-4.2.0-Linux-x86_64.sh</code></pre><p>然后安装</p><pre><code>bash Anaconda3-4.2.0-Linux-x86_64.sh</code></pre><p>装的时候有一个选项是将路径加到环境变量里面，如果忘了选可以用</p><pre><code>export PATH=&quot;/home/username/anaconda/bin:$PATH&quot;</code></pre><p>手动加入到环境变量里面，然后用</p><pre><code>conda create -n &lt;环境名字&gt; &lt;安装哪些packages&gt;</code></pre><p>来创建虚拟环境，最后用</p><pre><code>source activate &lt;环境名字&gt;</code></pre><p>进入虚拟环境</p><h2 id="2-安装Nginx"><a href="#2-安装Nginx" class="headerlink" title="2. 安装Nginx"></a>2. 安装Nginx</h2><pre><code>sudo apt-get install nginx</code></pre><h2 id="3-安装uWSGI"><a href="#3-安装uWSGI" class="headerlink" title="3. 安装uWSGI"></a>3. 安装uWSGI</h2><pre><code>pip install uwsgi</code></pre><h2 id="4-添加配置文件"><a href="#4-添加配置文件" class="headerlink" title="4. 添加配置文件"></a>4. 添加配置文件</h2><p>配置文件主要有两个，一个是Nginx那边的<code>.conf</code>文件，放在<code>/etc/nginx/conf.d/</code>目录下面，老的Nginx版本好像是去修改<code>/etc/nginx/</code>目录下的<code>nginx.conf</code>，这里算是一个坑吧，因为我装的Nginx版本比较新，所以按照老版本的方法试了好久都不能成功，还有一个是uWSGI的<code>.ini</code>文件，放在工程目录下面，这里贴一下两个示例配置文件</p><blockquote><p>xxx.conf</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen         80; </span><br><span class="line">    server_name    &lt;这里填用来访问的网址&gt;;</span><br><span class="line">    charset UTF-8;</span><br><span class="line">    access_log      &#x2F;var&#x2F;log&#x2F;nginx&#x2F;xxx_access.log;</span><br><span class="line">    error_log       &#x2F;var&#x2F;log&#x2F;nginx&#x2F;xxx_error.log;</span><br><span class="line"></span><br><span class="line">    client_max_body_size 75M;</span><br><span class="line"></span><br><span class="line">    location &#x2F; &#123; </span><br><span class="line">        include uwsgi_params;</span><br><span class="line">        uwsgi_pass 127.0.0.1:8000;</span><br><span class="line">        uwsgi_read_timeout 2;</span><br><span class="line">    &#125;   </span><br><span class="line">    location &#x2F;static &#123;</span><br><span class="line">        expires 30d;</span><br><span class="line">        autoindex on; </span><br><span class="line">        add_header Cache-Control private;</span><br><span class="line">        alias &#x2F;home&#x2F;ubuntu&#x2F;&lt;工程名&gt;&#x2F;static&#x2F;;</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><blockquote><p>xxx_uwsgi.ini</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># xxx_uwsgi.ini file</span><br><span class="line">[uwsgi]</span><br><span class="line"></span><br><span class="line"># Django-related settings</span><br><span class="line"></span><br><span class="line">socket &#x3D; :8000</span><br><span class="line"></span><br><span class="line"># the base directory (full path)</span><br><span class="line">chdir           &#x3D; &#x2F;home&#x2F;ubuntu&#x2F;&lt;工程名&gt;</span><br><span class="line"></span><br><span class="line"># Django s wsgi file</span><br><span class="line">module          &#x3D; xxx.wsgi</span><br><span class="line"></span><br><span class="line"># process-related settings</span><br><span class="line"># master</span><br><span class="line">master          &#x3D; true</span><br><span class="line"></span><br><span class="line"># maximum number of worker processes</span><br><span class="line">processes       &#x3D; 4</span><br><span class="line"></span><br><span class="line"># ... with appropriate permissions - may be needed</span><br><span class="line"># chmod-socket  &#x3D; 664</span><br><span class="line"># clear environment on exit</span><br><span class="line">vacuum          &#x3D; true</span><br></pre></td></tr></table></figure><p>这里注意<code>xxx.conf</code>中的<code>uwsgi_pass</code>端口号和<code>xxx_uwsgi.ini</code>中的<code>socket</code>要保持一致，Nginx和uWSGI就靠这个通信了。</p><h2 id="5-运行"><a href="#5-运行" class="headerlink" title="5. 运行"></a>5. 运行</h2><p>先用</p><pre><code>sudo /etc/init.d/nginx restart</code></pre><p>来重启一下Nginx，最后用</p><pre><code>uwsgi --ini /home/ubuntu/&lt;工程名&gt;/xxx_uwsgi.ini</code></pre><p>来启动uWSGI应该就可以访问了。</p><p>如果嫌每次都要输<code>export PATH=/home/ubuntu/anaconda/bin:$PATH</code>麻烦，可以在安装Anaconda后将安装路径添加到系统环境变量中，步骤如下：</p><ol><li>在终端输入<code>sudo vim /etc/profile</code>，打开profile文件</li><li>在文件末尾添加一行<code>export PATH=/home/ubuntu/anaconda/bin:$PATH</code></li><li><code>source /etc/profile</code>更新profile文件即可</li></ol><p>另外可以用Supervisor来守护uwsgi进程，免去uwsgi进程挂了或者服务器重启的时候还要手动去启动uwsgi进程的烦恼，详情见<a href="/2017/09/23/Supervisor不完全填坑指北/" title="Supervisor不完全填坑指北">Supervisor不完全填坑指北</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;写网站，部署永远是一个回避不了而且让人头疼的问题，为了方便自己以后部署，这里把部署的过程以及遇到的坑记下来。&lt;br&gt;
    
    </summary>
    
    
      <category term="实战经验" scheme="https://chaizi.one/categories/%E5%AE%9E%E6%88%98%E7%BB%8F%E9%AA%8C/"/>
    
    
      <category term="Python" scheme="https://chaizi.one/tags/Python/"/>
    
      <category term="Django" scheme="https://chaizi.one/tags/Django/"/>
    
      <category term="Nginx" scheme="https://chaizi.one/tags/Nginx/"/>
    
      <category term="uWSGI" scheme="https://chaizi.one/tags/uWSGI/"/>
    
  </entry>
  
  <entry>
    <title>Python+Django实现个人信息查询网站（二）</title>
    <link href="https://chaizi.one/2016/11/08/Python+Django%E5%AE%9E%E7%8E%B0%E4%B8%AA%E4%BA%BA%E4%BF%A1%E6%81%AF%E6%9F%A5%E8%AF%A2%E7%BD%91%E7%AB%99%EF%BC%88%E4%BA%8C%EF%BC%89/"/>
    <id>https://chaizi.one/2016/11/08/Python+Django%E5%AE%9E%E7%8E%B0%E4%B8%AA%E4%BA%BA%E4%BF%A1%E6%81%AF%E6%9F%A5%E8%AF%A2%E7%BD%91%E7%AB%99%EF%BC%88%E4%BA%8C%EF%BC%89/</id>
    <published>2016-11-07T16:00:00.000Z</published>
    <updated>2020-02-29T13:08:29.558Z</updated>
    
    <content type="html"><![CDATA[<p>不知不觉拖了近两个月，总算把第一版网站上线了，在线访问网址<a href="http://njnu.chaiziyi.com.cn/" title="http://njnu.chaiziyi.com.cn/">查南师，你想要的信息都在这里！</a><br><span id="more"></span></p><p>网站现在主要就4个功能，其中无需登录就可以使用的只有免验证码快速查询教务系统成绩，另外的根据学号查询个人信息、根据姓名查询个人信息和免密码查询教务系统成绩3个功能需要登录以后才能使用。</p><p>根据学号查询个人信息和根据姓名查询个人信息查的是之前爬的学校的数据，免密码查询教务系统成绩是利用的教务系统的一个漏洞，这个之前写GUI的时候也提到过。</p><p>登录系统用的Django自带的认证系统，发现比自己写登录认证方便多了，还安全，需要登录的页面只要加上一个<code>@login_required</code>的装饰器就好了。</p><p>放点网站截图吧，无图无真相。</p><blockquote><p>首页</p></blockquote><p><img src="https://i.imgur.com/mhOktBv.png" alt=""></p><blockquote><p>免验证码快速查询教务系统成绩</p></blockquote><p><img src="https://i.imgur.com/4qAp8SL.png" alt=""></p><blockquote><p>根据学号查询个人信息</p></blockquote><p><img src="https://i.imgur.com/eltheoI.png" alt=""></p><blockquote><p>根据姓名查询个人信息</p></blockquote><p><img src="https://i.imgur.com/h4o7ilU.png" alt=""></p><blockquote><p>免密码查询教务系统成绩</p></blockquote><p><img src="https://i.imgur.com/iYbhQKs.png" alt=""></p><p>上一篇提到的验证码、以图找图还有Facemash等功能都还没写，一是水平有限，二是想着先做出点能用的东西出来，怕拖着拖着最后什么都写不出来，后面有时间再加功能吧。</p><p>之前说的传Github想想还是不了，毕竟很多都是隐私的东西，自己玩玩就好了，不想被查水表。</p><p>最后，注册功能暂时就不开放了（逃……</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;不知不觉拖了近两个月，总算把第一版网站上线了，在线访问网址&lt;a href=&quot;http://njnu.chaiziyi.com.cn/&quot; title=&quot;http://njnu.chaiziyi.com.cn/&quot;&gt;查南师，你想要的信息都在这里！&lt;/a&gt;&lt;br&gt;
    
    </summary>
    
    
      <category term="项目成果" scheme="https://chaizi.one/categories/%E9%A1%B9%E7%9B%AE%E6%88%90%E6%9E%9C/"/>
    
    
      <category term="Python" scheme="https://chaizi.one/tags/Python/"/>
    
      <category term="Django" scheme="https://chaizi.one/tags/Django/"/>
    
  </entry>
  
  <entry>
    <title>Python实现教务系统快速查分（三）</title>
    <link href="https://chaizi.one/2016/11/03/Python%E5%AE%9E%E7%8E%B0%E6%95%99%E5%8A%A1%E7%B3%BB%E7%BB%9F%E5%BF%AB%E9%80%9F%E6%9F%A5%E5%88%86%EF%BC%88%E4%B8%89%EF%BC%89/"/>
    <id>https://chaizi.one/2016/11/03/Python%E5%AE%9E%E7%8E%B0%E6%95%99%E5%8A%A1%E7%B3%BB%E7%BB%9F%E5%BF%AB%E9%80%9F%E6%9F%A5%E5%88%86%EF%BC%88%E4%B8%89%EF%BC%89/</id>
    <published>2016-11-02T16:00:00.000Z</published>
    <updated>2020-02-29T13:08:47.560Z</updated>
    
    <content type="html"><![CDATA[<p>上次说要在3.0版本把验证码给去了，嗯。<br><span id="more"></span></p><p>之前用过一次pytesseract来识别验证码，所以这次写也没什么难度，代码如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Verify</span>():</span></span><br><span class="line">    r = s.get(url2, headers=header)</span><br><span class="line">    buff = StringIO.StringIO(r.content)</span><br><span class="line">    im = Image.<span class="built_in">open</span>(buff)</span><br><span class="line">    im = im.<span class="built_in">filter</span>(ImageFilter.MedianFilter())</span><br><span class="line">    enhancer = ImageEnhance.Contrast(im)</span><br><span class="line">    im = enhancer.enhance(<span class="number">2</span>)</span><br><span class="line">    im = im.convert(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    vcode = pytesseract.image_to_string(im, config=<span class="string">&#x27;-psm 3&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> vcode</span><br></pre></td></tr></table></figure><p>获取验证码然后稍微处理一下再识别会大大提高识别率，但仍然不能保证100%的识别正确率，所以这里的办法就是不断识别直到识别出为止，正好教务网站对于验证码错误有个特别的返回值401，这里就简单多了</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">status = getStatus(username, pwd, yzm)</span><br><span class="line"><span class="keyword">while</span>(status[<span class="string">&#x27;status&#x27;</span>] == <span class="string">&#x27;401&#x27;</span>):</span><br><span class="line">    yzm = Verify()</span><br><span class="line">    status = getStatus(username, pwd, yzm)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>左上角的那个图标本来只需要下面两行代码就可以实现</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">self.icon = wx.Icon(<span class="string">&#x27;icon.ico&#x27;</span>, wx.BITMAP_TYPE_ICO)</span><br><span class="line">self.SetIcon(self.icon)  </span><br></pre></td></tr></table></figure><p>但是这样在Pyinstaller生成exe时还得把ico文件附在后面，不能打包进exe，这里的办法是改变代码查找文件的路径，因为exe执行的时候其实是生成了一个临时的文件夹来存放这些依赖文件，所以我们需要告诉程序到这个临时文件夹中去找图标，代码如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">resource_path</span>(<span class="params">relative_path</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; Get absolute path to resource, works for dev and for PyInstaller &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># PyInstaller creates a temp folder and stores path in _MEIPASS</span></span><br><span class="line">        base_path = sys._MEIPASS</span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        base_path = os.path.abspath(<span class="string">&quot;.&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> os.path.join(base_path, relative_path)</span><br></pre></td></tr></table></figure><p>调用上面这个函数即可</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">self.icon = wx.Icon(resource_path(<span class="string">&#x27;icon.ico&#x27;</span>), wx.BITMAP_TYPE_ICO)</span><br><span class="line">self.SetIcon(self.icon)  </span><br><span class="line"> </span><br></pre></td></tr></table></figure><p>想看源码的还是请移步我的Github:<a href="https://github.com/crazyczy/njnu-quick-check-results" title="njnu-quick-check-results">njnu-quick-check-results</a></p><blockquote><p>v3.0</p></blockquote><p>因为识别验证码要依赖tesseract-ocr这个库，试了一下午都不能把tesseract-ocr这个库也打包进exe，所以用Pyinstaller生成的exe并不能直接用，还是要在客户机上装完tesseract-ocr才能用，所以这次的exe就不放上来了，后面做成web就可以完美避开这个问题了。果然客户端没web有前途……</p><blockquote><p>正确查询界面</p></blockquote><p><img src="https://i.imgur.com/JMr5kbD.png" alt=""></p><p>客户端版本的应该不会再写了，也没啥好写的了，下一步把这个功能整合到我之前写的那个个人信息查询网站上，那样用起来应该更方便。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;上次说要在3.0版本把验证码给去了，嗯。&lt;br&gt;
    
    </summary>
    
    
      <category term="项目成果" scheme="https://chaizi.one/categories/%E9%A1%B9%E7%9B%AE%E6%88%90%E6%9E%9C/"/>
    
    
      <category term="Python" scheme="https://chaizi.one/tags/Python/"/>
    
      <category term="wxPython" scheme="https://chaizi.one/tags/wxPython/"/>
    
      <category term="GUI" scheme="https://chaizi.one/tags/GUI/"/>
    
      <category term="验证码" scheme="https://chaizi.one/tags/%E9%AA%8C%E8%AF%81%E7%A0%81/"/>
    
  </entry>
  
  <entry>
    <title>Python实现教务系统快速查分（二）</title>
    <link href="https://chaizi.one/2016/10/31/Python%E5%AE%9E%E7%8E%B0%E6%95%99%E5%8A%A1%E7%B3%BB%E7%BB%9F%E5%BF%AB%E9%80%9F%E6%9F%A5%E5%88%86%EF%BC%88%E4%BA%8C%EF%BC%89/"/>
    <id>https://chaizi.one/2016/10/31/Python%E5%AE%9E%E7%8E%B0%E6%95%99%E5%8A%A1%E7%B3%BB%E7%BB%9F%E5%BF%AB%E9%80%9F%E6%9F%A5%E5%88%86%EF%BC%88%E4%BA%8C%EF%BC%89/</id>
    <published>2016-10-30T16:00:00.000Z</published>
    <updated>2020-02-29T13:09:46.877Z</updated>
    
    <content type="html"><![CDATA[<p>上次写的控制台版的教务系统快速查分实在是有点丑，所以在上次的基础之上写了个GUI版的。<br><span id="more"></span></p><p>获取数据方面跟上次大同小异，主要是GUI界面的编写，上次第一次写的GUI自己都看不下去了，这次好好研究了一下布局，至少勉强能看了。</p><p>布局选用的是GridBagSizer，这是一种多功能sizer，它比FlexiGridSizer提供了更多的增强功能，子构件可被添加到网格中的指定单元格。此外，一个子物件可以在水平或垂直地占据一个以上的单元。 因此，在同一行中的静态文本和多行文本控件可以有不同的宽度和高度。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__do_layout</span>(<span class="params">self</span>):</span></span><br><span class="line"></span><br><span class="line">    sizer = wx.GridBagSizer(<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    sizer.Add(self.label_1, (<span class="number">0</span>, <span class="number">0</span>), (<span class="number">1</span>, <span class="number">1</span>), wx.ALL, <span class="number">5</span>)</span><br><span class="line">    sizer.Add(self.text_ctrl_1, (<span class="number">0</span>, <span class="number">1</span>), (<span class="number">1</span>, <span class="number">2</span>), wx.EXPAND | wx.ALL, <span class="number">5</span>)</span><br><span class="line">    sizer.Add(self.label_2, (<span class="number">1</span>, <span class="number">0</span>), (<span class="number">1</span>, <span class="number">1</span>), wx.ALL, <span class="number">5</span>)</span><br><span class="line">    sizer.Add(self.text_ctrl_2, (<span class="number">1</span>, <span class="number">1</span>), (<span class="number">1</span>, <span class="number">2</span>), wx.EXPAND | wx.ALL, <span class="number">5</span>)</span><br><span class="line">    sizer.Add(self.label_3, (<span class="number">2</span>, <span class="number">0</span>), (<span class="number">1</span>, <span class="number">1</span>), wx.ALL, <span class="number">5</span>)</span><br><span class="line">    sizer.Add(self.text_ctrl_3, (<span class="number">2</span>, <span class="number">1</span>), (<span class="number">1</span>, <span class="number">1</span>), wx.EXPAND | wx.ALL, <span class="number">5</span>)</span><br><span class="line">    sizer.Add(self.bitmap_button_1, (<span class="number">2</span>, <span class="number">2</span>), (<span class="number">1</span>, <span class="number">1</span>), wx.EXPAND | wx.ALL, <span class="number">5</span>)</span><br><span class="line">    sizer.Add(self.button_1, (<span class="number">3</span>, <span class="number">1</span>), (<span class="number">1</span>, <span class="number">1</span>), wx.ALL | wx.ALIGN_RIGHT, <span class="number">5</span>)</span><br><span class="line">    sizer.Add(self.button_2, (<span class="number">3</span>, <span class="number">2</span>), (<span class="number">1</span>, <span class="number">1</span>), wx.ALL | wx.ALIGN_RIGHT, <span class="number">5</span>)</span><br><span class="line">    sizer.Add(self.static_bitmap_1, (<span class="number">0</span>, <span class="number">3</span>), (<span class="number">4</span>, <span class="number">1</span>), wx.EXPAND | wx.ALL, <span class="number">5</span>)</span><br><span class="line">    sizer.Add(self.text_ctrl_4, (<span class="number">0</span>, <span class="number">4</span>), (<span class="number">4</span>, <span class="number">1</span>), wx.EXPAND | wx.ALL, <span class="number">5</span>)</span><br><span class="line">    sizer.Add(self.list_ctrl_1, (<span class="number">4</span>, <span class="number">0</span>), (<span class="number">1</span>, <span class="number">5</span>), wx.EXPAND | wx.ALL, <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">    sizer.AddGrowableRow(<span class="number">4</span>, <span class="number">1</span>)</span><br><span class="line">    sizer.AddGrowableCol(<span class="number">4</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    self.panel.SetSizerAndFit(sizer)</span><br></pre></td></tr></table></figure><p>以上就是布局部分的代码，AddGrowableRow和AddGrowableCol用来设置可拉伸的行和列。</p><p>布完局剩下的就简单了，从输入框获取用户输入的数据然后处理一下返回结果即可。</p><p>这里要说一下SetColumnWidth的参数，这个函数是用来设置ListCtrl控件的列宽的，但是这里如果用<code>wx.LIST_AUTOSIZE</code>这个参数只会将表下面的列调整到合适的列宽而表头却不会，所以这里正确的参数应该是用<code>wx.LIST_AUTOSIZE_USEHEADER</code>。</p><p>2.0版本就是很普通的一个GUI的查分软件，后来在2.1版本中我把之前写的第一个GUI程序功能也加进来了，就是在查成绩时可以看到自己的证件照，这里因为原先照片有点大如果直接放上去会有点违和，所以我想把原图片先缩小再放上去，代码如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">image = wx.ImageFromStream(StringIO(req.content), wx.BITMAP_TYPE_ANY)</span><br><span class="line">image = image.Scale(<span class="number">105</span>, <span class="number">147</span>, wx.IMAGE_QUALITY_HIGH)</span><br><span class="line">result = wx.BitmapFromImage(image)</span><br></pre></td></tr></table></figure><p>其他好像也没啥好说的了。</p><p>想看源码的还是请移步我的Github:<a href="https://github.com/crazyczy/njnu-quick-check-results" title="njnu-quick-check-results">njnu-quick-check-results</a></p><blockquote><p>v2.1 下载地址</p></blockquote><p><a href="https://github.com/crazyczy/njnu-quick-check-results/releases/download/2.1/NJNU_Quick_Check_Results_v2.1.GUI.exe" title="NJNU_Quick_Check_Results_v2.1.GUI.exe">NJNU_Quick_Check_Results_v2.1.GUI.exe</a></p><p><img src="https://i.imgur.com/p4cBLoj.png" alt=""></p><blockquote><p>v2.0 下载地址</p></blockquote><p><a href="https://github.com/crazyczy/njnu-quick-check-results/releases/download/2.0/NJNU_Quick_Check_Results_v2.0.GUI.exe" title="NJNU_Quick_Check_Results_v2.0.GUI.exe">NJNU_Quick_Check_Results_v2.0.GUI.exe</a></p><blockquote><p>正确查询界面</p></blockquote><p><img src="https://i.imgur.com/U9hR62a.png" alt=""></p><blockquote><p>账号或密码输错界面</p></blockquote><p><img src="https://i.imgur.com/3fdB8pH.png" alt=""></p><blockquote><p>验证码输错界面</p></blockquote><p><img src="https://i.imgur.com/L3ZxmMu.png" alt=""></p><p>3.0版去掉验证码，加油！</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;上次写的控制台版的教务系统快速查分实在是有点丑，所以在上次的基础之上写了个GUI版的。&lt;br&gt;
    
    </summary>
    
    
      <category term="项目成果" scheme="https://chaizi.one/categories/%E9%A1%B9%E7%9B%AE%E6%88%90%E6%9E%9C/"/>
    
    
      <category term="Python" scheme="https://chaizi.one/tags/Python/"/>
    
      <category term="wxPython" scheme="https://chaizi.one/tags/wxPython/"/>
    
      <category term="GUI" scheme="https://chaizi.one/tags/GUI/"/>
    
  </entry>
  
  <entry>
    <title>Python实现教务系统快速查分（一）</title>
    <link href="https://chaizi.one/2016/10/24/Python%E5%AE%9E%E7%8E%B0%E6%95%99%E5%8A%A1%E7%B3%BB%E7%BB%9F%E5%BF%AB%E9%80%9F%E6%9F%A5%E5%88%86%EF%BC%88%E4%B8%80%EF%BC%89/"/>
    <id>https://chaizi.one/2016/10/24/Python%E5%AE%9E%E7%8E%B0%E6%95%99%E5%8A%A1%E7%B3%BB%E7%BB%9F%E5%BF%AB%E9%80%9F%E6%9F%A5%E5%88%86%EF%BC%88%E4%B8%80%EF%BC%89/</id>
    <published>2016-10-23T16:00:00.000Z</published>
    <updated>2020-02-29T13:09:34.314Z</updated>
    
    <content type="html"><![CDATA[<p>每次查成绩都要到学校教务系统那个破网站上点好多次才能看到分数，我就想能不能自己写一个快速查分的脚本呢？找了找没找到api接口，只能自己一步步来获取数据了。<br><span id="more"></span></p><p>下面就是教务管理系统的界面，需要学号密码和验证码才能登录。<br><img src="https://i.imgur.com/AKmpyrC.png" alt=""></p><p>用浏览器登录一下，然后在后台找到post的数据。<br><img src="https://i.imgur.com/2p53kFx.png" alt=""></p><p>username和randnumber也就是验证码提交的都是明文，但是密码是被加密提交的，第一个问题就是找出加密方式，我在js文件里没找到，最后竟然藏在了登录页面里面，这代码写的也是没谁了。<br><img src="https://i.imgur.com/SnAufpo.png" alt=""></p><p>验证码的问题暂时先用讨巧的方法来解决的，就是显示出来然后让用户输入一下。</p><p>登录进去以后，本以为只需要找到显示成绩的页面再爬取下来分析一下就好了，结果按照以前的方法却不能成功。大概看了一下，发现成绩显示在一个iframe里面，而这个iframe又在另一个iframe里面，如果直接访问那个显示成绩的界面，会跳转到一个错误界面，爬下来的页面也就是那个错误页面，这当然不是我想要的结果。</p><p>我试着按照页面执行的顺序依次去提交这几个页面，结果也不行，到了最后那个成绩界面还是有错。后来我想是不是因为数据是异步获取的所以要在Python里面执行js才行，为此我还专门用selenium试了好久，可最终还是没试出来。</p><p>就在我快要放弃这一计划的时候，偶然间看到网上一个爬虫的headers里面有一个Referer，而我之前的headers里面只有User-Agent这一项，试着加上了Referer之后再提交竟然成功了！本以为headers只是用来伪装成浏览器，没想到还有这个作用，又get到一条宝贵经验。</p><p>有了数据页面接下来就简单多了，以前都是用正则匹配的，这次换了种方法用了更加方便的BeautifulSoup4库。</p><p>代码有点长就不贴上来了，想要看源码的请移步我的Github:<a href="https://github.com/crazyczy/njnu-quick-check-results" title="njnu-quick-check-results">njnu-quick-check-results</a></p><blockquote><p>v1.1 下载地址</p></blockquote><p><a href="https://github.com/crazyczy/njnu-quick-check-results/releases/download/1.1/NJNU_Quick_Check_Results_v1.1.Console.exe" title="NJNU_Quick_Check_Results_v1.1.Console.exe">NJNU_Quick_Check_Results_v1.1.Console.exe</a></p><p>1.1版把输入密码换成了星号显得更加安全，然后加上了验证码和账号密码输错的错误输出，不会像上一个版本直接崩溃。不过两个版本都有一个问题就是最后其实是要按回车键才能退出，写成任意键了……</p><blockquote><p>正确查询界面</p></blockquote><p><img src="https://i.imgur.com/kXW5k4P.png" alt=""></p><blockquote><p>账号或密码输错界面</p></blockquote><p><img src="https://i.imgur.com/pvp4Yjy.png" alt=""></p><blockquote><p>验证码输错界面</p></blockquote><p><img src="https://i.imgur.com/yqgU7h7.png" alt=""></p><blockquote><p>v1.0 下载地址</p></blockquote><p><a href="https://github.com/crazyczy/NJNU_Quick_Check_Results/releases/download/1.0/NJNU_Quick_Check_Results_v1.0.Console.exe" title="NJNU_Quick_Check_Results_v1.0.Console.exe">NJNU_Quick_Check_Results_v1.0.Console.exe</a></p><p>1.0版只是简单的实现了查询教务系统成绩的功能，没有用GUI界面，没有去掉验证码，也没有加上错误判断。</p><blockquote><p>正确查询界面</p></blockquote><p><img src="https://i.imgur.com/vHlV0uY.png" alt=""></p><p>最后能获取到成绩还是挺有成就感的，但是现在还是控制台版很丑也不方便，下一步打算在2.0版本做个GUI界面，3.0可以利用图像识别把验证码给去了，然后有时间还可以作为一个功能整合到我之前的那个个人信息查询网站上面。哦对了，我好像还发现教务系统存在越权访问漏洞，理论上我可以获取到全校所有人的成绩，有机会写个爬虫爬一下（逃……</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;每次查成绩都要到学校教务系统那个破网站上点好多次才能看到分数，我就想能不能自己写一个快速查分的脚本呢？找了找没找到api接口，只能自己一步步来获取数据了。&lt;br&gt;
    
    </summary>
    
    
      <category term="项目成果" scheme="https://chaizi.one/categories/%E9%A1%B9%E7%9B%AE%E6%88%90%E6%9E%9C/"/>
    
    
      <category term="Python" scheme="https://chaizi.one/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>用wxPython写了一个证件照查看器</title>
    <link href="https://chaizi.one/2016/10/23/%E7%94%A8wxPython%E5%86%99%E4%BA%86%E4%B8%80%E4%B8%AA%E8%AF%81%E4%BB%B6%E7%85%A7%E6%9F%A5%E7%9C%8B%E5%99%A8/"/>
    <id>https://chaizi.one/2016/10/23/%E7%94%A8wxPython%E5%86%99%E4%BA%86%E4%B8%80%E4%B8%AA%E8%AF%81%E4%BB%B6%E7%85%A7%E6%9F%A5%E7%9C%8B%E5%99%A8/</id>
    <published>2016-10-22T16:00:00.000Z</published>
    <updated>2020-02-29T13:12:58.532Z</updated>
    
    <content type="html"><![CDATA[<p>之前一直写的是在控制台运行的Python程序，昨天突发奇想，能不能用Python写GUI呢？一查还真可以，PyQt，wxPython，TkInter都是不错的库，权衡了一下我决定用wxPython来写点小东西玩一下。<br><span id="more"></span></p><p>之前在<a href="/2016/06/03/利用Python爬取学校网站上的证件照（四）/" title="利用Python爬取学校网站上的证件照（四）">利用Python爬取学校网站上的证件照（四）</a>这篇博客里提到学校教务系统存在越权访问漏洞，不如就根据这个来写一个学校证件照查看器吧。</p><p>原理很简单，只要根据学号构造出正确的url就可以获取相应的证件照了，难点在于我对于Python的GUI编程一无所知，所以只能一边查文档一边写。</p><p>遇到的第一个问题是事件绑定以后的值传递，我把文本框的<code>wx.EVT_TEXT</code>事件和显示图片函数绑定以后，不知道怎么把文本框的值传给函数，因为我需要根据输入值来构造url，所以没有这个值就什么也干不了。后来我发现可以传过来一个CommandEvent类型的东西，再对它<code>GetString()</code>一下就可以获得我想要的值了。</p><p>第二个问题是图片的获取问题，<code>wx.Image</code>函数的第一个参数是一个本地图片路径的字符串，可是我的图片是从网上获得的，直接传url给函数会报错。一开始我想先把图片下到本地，然后显示了以后再把本地图片删掉，但是总觉得这样有点蠢，而且如果用户有同名的文件还会误删。后来继续查，发线可以用<code>wx.ImageFromStream</code>这个函数来获取图片流，又解决了一个问题。</p><p>最后就是控件的位置摆放了，虽然没几个控件，但要是摆好看还真不容易。用了<code>wx.FlexGridSizer</code>但感觉总得不到我想要的结果，最后干脆直接用绝对坐标写死在代码里了。</p><p>代码没多少行，但真的比非GUI的Python程序难写多了，本来Python是一门很简洁的语言，但到了GUI这里就一点都不简洁了。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> wx</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> cStringIO <span class="keyword">import</span> StringIO</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://223.2.10.123/jwgl/photos/rx20&#x27;</span></span><br><span class="line"></span><br><span class="line">header = &#123;<span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\</span></span><br><span class="line"><span class="string">/537.36 (KHTML, like Gecko) Chrome/49.0.2623.112 Safari/537.36&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Frame</span>(<span class="params">wx.Frame</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        wx.Frame.__init__(self, <span class="literal">None</span>, -<span class="number">1</span>, <span class="string">u&#x27;南师大证件照查看器&#x27;</span>,</span><br><span class="line">                          size=(<span class="number">300</span>, <span class="number">360</span>))</span><br><span class="line">        self.Centre()</span><br><span class="line">        hbox = wx.BoxSizer(wx.HORIZONTAL)</span><br><span class="line">        panel1 = wx.Panel(self, -<span class="number">1</span>)</span><br><span class="line">        sizer = wx.FlexGridSizer(<span class="number">1</span>, <span class="number">2</span>, <span class="number">10</span>, <span class="number">10</span>)</span><br><span class="line">        basicLabel = wx.StaticText(panel1, -<span class="number">1</span>, <span class="string">u&#x27;请输入要查询的学号：&#x27;</span>)</span><br><span class="line">        basicText = wx.TextCtrl(panel1, -<span class="number">1</span>, size=(<span class="number">100</span>, <span class="number">18</span>))</span><br><span class="line">        basicText.SetInsertionPoint(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">        self.Bind(wx.EVT_TEXT, self.showImage, basicText)</span><br><span class="line"></span><br><span class="line">        sizer.AddMany([basicLabel, basicText])</span><br><span class="line">        hbox.Add(sizer, proportion=<span class="number">2</span>, flag=wx.ALL | wx.EXPAND, border=<span class="number">15</span>)</span><br><span class="line">        panel1.SetSizer(hbox)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">showImage</span>(<span class="params">self, text</span>):</span></span><br><span class="line">        panel2 = wx.Panel(self, -<span class="number">1</span>, (<span class="number">70</span>, <span class="number">50</span>), (<span class="number">150</span>, <span class="number">210</span>))</span><br><span class="line">        panel2.Refresh()</span><br><span class="line">        <span class="built_in">id</span> = text.GetString()</span><br><span class="line">        year = <span class="built_in">id</span>[<span class="number">2</span>:<span class="number">4</span>]</span><br><span class="line">        name = <span class="built_in">id</span> + <span class="string">&#x27;.jpg&#x27;</span></span><br><span class="line">        turl = url + year + <span class="string">&#x27;/&#x27;</span> + name</span><br><span class="line">        req = requests.get(turl, headers=header)</span><br><span class="line">        <span class="keyword">if</span> req.headers.get(<span class="string">&#x27;content-length&#x27;</span>) != <span class="string">&#x27;1163&#x27;</span>:</span><br><span class="line">            image = wx.ImageFromStream(</span><br><span class="line">                StringIO(req.content), wx.BITMAP_TYPE_ANY)</span><br><span class="line">            temp = image.ConvertToBitmap()</span><br><span class="line">            wx.StaticBitmap(parent=panel2, bitmap=temp)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app = wx.App()</span><br><span class="line">    frame = Frame()</span><br><span class="line">    frame.Show()</span><br><span class="line">    app.MainLoop()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://i.imgur.com/IUnRHx1.png" alt=""></p><p><img src="https://i.imgur.com/ceaTwQT.png" alt=""></p><p>跟上次那个校园网自动登录器一样，我也生成了一个exe文件方便没有安装Python环境的用户使用，这次还特地用32位的Python生成的，所以这个exe就能通用了哈哈。</p><p><strong>下载地址</strong>：<a href="https://github.com/crazyczy/njnu-passport-inquiry/releases/download/1.0/NJNU_Passport_Inquiry.exe" title="NJNU_Passport_Inquiry.exe">NJNU_Passport_Inquiry.exe</a></p><p>因为这个程序太简单，所以wxPython还有很多好玩的的函数我都没有用到，下次写GUI程序的时候再看看吧，不过写GUI真的好晕，就不知道下次什么时候写了……</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;之前一直写的是在控制台运行的Python程序，昨天突发奇想，能不能用Python写GUI呢？一查还真可以，PyQt，wxPython，TkInter都是不错的库，权衡了一下我决定用wxPython来写点小东西玩一下。&lt;br&gt;
    
    </summary>
    
    
      <category term="项目成果" scheme="https://chaizi.one/categories/%E9%A1%B9%E7%9B%AE%E6%88%90%E6%9E%9C/"/>
    
    
      <category term="Python" scheme="https://chaizi.one/tags/Python/"/>
    
      <category term="wxPython" scheme="https://chaizi.one/tags/wxPython/"/>
    
      <category term="GUI" scheme="https://chaizi.one/tags/GUI/"/>
    
  </entry>
  
  <entry>
    <title>校园网换了认证页面以后</title>
    <link href="https://chaizi.one/2016/10/22/%E6%A0%A1%E5%9B%AD%E7%BD%91%E6%8D%A2%E4%BA%86%E8%AE%A4%E8%AF%81%E9%A1%B5%E9%9D%A2%E4%BB%A5%E5%90%8E/"/>
    <id>https://chaizi.one/2016/10/22/%E6%A0%A1%E5%9B%AD%E7%BD%91%E6%8D%A2%E4%BA%86%E8%AE%A4%E8%AF%81%E9%A1%B5%E9%9D%A2%E4%BB%A5%E5%90%8E/</id>
    <published>2016-10-21T16:00:00.000Z</published>
    <updated>2020-02-29T13:12:40.561Z</updated>
    
    <content type="html"><![CDATA[<p>之前在<a href="/2016/06/22/用Python写一个校园网自动登录器/" title="用Python写一个校园网自动登录器">用Python写一个校园网自动登录器</a>这篇博客里面完成过一个校园网自动登录器，本来还期待着能用上一段时间，谁知道这才没多久，学校就把认证页面给换了，当然那个登录器也就没用了。<br><span id="more"></span></p><p><img src="https://i.imgur.com/6VTXVsf.png" alt=""></p><p>新的认证界面如上图，本来以为跟之前那个网页大同小异，结果url就把我吓了一跳，一长串的参数，关键我还找不出这些参数是从哪里获取的。<br><img src="https://i.imgur.com/c9OrpZo.png" alt=""></p><p>看参数名字是一些ip地址，mac地址之类的，而且都加过密了，加密方式感觉也各不相同，有长有短。真正的登陆url其实是下面这个，向这个url post一些参数就可以实现登陆。<br><img src="https://i.imgur.com/Y6DozUk.png" alt=""></p><p>这些参数里面虽然包含上面url中那堆看不懂的参数，但幸运的是，并不需要改变那些参数值，直接加上账号密码等其他参数一起提交就行了，账号密码也没有加密，都是直接提交的明文，后面的三个参数都是空的，感觉也不重要。<br><img src="https://i.imgur.com/GXhUy87.png" alt=""></p><p>最后问题只剩下搞懂那堆参数的含义、获取方式以及加密方式了，然而试了很久发现自己并不能弄得懂。其实弄不懂也没什么关系，我只要把参数一起提交上去就行了，至于这些参数什么含义并不重要。因为那些参数没法在代码里自动获取，只能通过手动复制下来然后写死在代码里，所以可能这样写出来的代码只能固定电脑固定ip使用，这并不是我想要的结果。</p><p>然后前两天我突然想到，我们刚上大学那时候锐捷还是要用客户端登录的，为了防止一个账号多人使用还需要绑定mac地址，然而现在账号并不需要绑定mac地址了，那它参数里面提交的macip参数还有什么意义？所以会不会那些参数提不提交都一样，我试着把参数置空再提交，发现并不行，说明至少有一个参数是有用的，没办法只能一个个排除，最后发现只要提交nasip这一个参数就可以了，其余那些参数都可有可无（笑……</p><p>至于这个参数什么意思我也不清楚，好像是服务器的ip吧，我拿其他几个同学的电脑都试了一下发现这个值大家都一样，这么看来又可以写出通用的校园网登录器了。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;之前在&lt;a href=&quot;/2016/06/22/用Python写一个校园网自动登录器/&quot; title=&quot;用Python写一个校园网自动登录器&quot;&gt;用Python写一个校园网自动登录器&lt;/a&gt;这篇博客里面完成过一个校园网自动登录器，本来还期待着能用上一段时间，谁知道这才没多久，学校就把认证页面给换了，当然那个登录器也就没用了。&lt;br&gt;
    
    </summary>
    
    
      <category term="日常心得" scheme="https://chaizi.one/categories/%E6%97%A5%E5%B8%B8%E5%BF%83%E5%BE%97/"/>
    
    
      <category term="其他" scheme="https://chaizi.one/tags/%E5%85%B6%E4%BB%96/"/>
    
  </entry>
  
</feed>
